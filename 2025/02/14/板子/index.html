<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>板子 | Oldplace</title><meta name="author" content="player"><meta name="copyright" content="player"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="工具代码基本框架1234567891011121314151617#include&lt;bits&#x2F;stdc++.h&gt;#define debug(...) fprintf(stderr, __VA_ARGS__)using namespace std;typedef long long LL;void get_char_array(char *s)&amp;#123;    static char">
<meta property="og:type" content="article">
<meta property="og:title" content="板子">
<meta property="og:url" content="http://oldplace.github.io/2025/02/14/%E6%9D%BF%E5%AD%90/index.html">
<meta property="og:site_name" content="Oldplace">
<meta property="og:description" content="工具代码基本框架1234567891011121314151617#include&lt;bits&#x2F;stdc++.h&gt;#define debug(...) fprintf(stderr, __VA_ARGS__)using namespace std;typedef long long LL;void get_char_array(char *s)&amp;#123;    static char">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oldplace.github.io/img/my%20avatar.jpg">
<meta property="article:published_time" content="2025-02-14T14:38:07.000Z">
<meta property="article:modified_time" content="2025-02-19T04:28:44.693Z">
<meta property="article:author" content="player">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://oldplace.github.io/img/my%20avatar.jpg"><link rel="shortcut icon" href="/img/author16.png"><link rel="canonical" href="http://oldplace.github.io/2025/02/14/%E6%9D%BF%E5%AD%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '板子',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2025-02-19 12:28:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4233465_4sh0n7ckry.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/my%20avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">159</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">70</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Oldplace"><span class="site-name">Oldplace</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">板子</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-14T14:38:07.000Z" title="发表于 2025-02-14 22:38:07">2025-02-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-02-19T04:28:44.693Z" title="更新于 2025-02-19 12:28:44">2025-02-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BF%A1%E6%81%AF%E5%AD%A6/">信息学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>70分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="板子"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><h2 id="代码基本框架"><a href="#代码基本框架" class="headerlink" title="代码基本框架"></a>代码基本框架</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf(stderr, __VA_ARGS__)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_char_array</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> st[N];</span><br><span class="line">    cin &gt;&gt; st;</span><br><span class="line">    <span class="built_in">memcpy</span>(s + <span class="number">1</span>, st, <span class="built_in">sizeof</span>(<span class="type">char</span>) * (<span class="built_in">strlen</span>(st) + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// cin.sync_with_stdio(false);</span></span><br><span class="line">    <span class="comment">// cin.tie(0);</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h2><p>Windows：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%: %.cpp</span><br><span class="line">	g++ $&lt; -o $@ -Wextra -Wall -g -Wl,--stack=<span class="number">100000000000</span> -Wconversion -Wshadow</span><br></pre></td></tr></table></figure>
<p>Linux：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%: %.cpp</span><br><span class="line">	g++ $&lt; -o $@ -Wextra -Wall -g -Wl,--stack=<span class="number">100000000000</span> -Wconversion -Wshadow -fsanitize=address -fsanitize=undefined</span><br></pre></td></tr></table></figure>
<h2 id="编译优化"><a href="#编译优化" class="headerlink" title="编译优化"></a>编译优化</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fast = O3 + ffast‐math + fallow‐store‐data‐races</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC optimize(<span class="string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC target(<span class="string">&quot;sse2,abm,fma,mmx,avx2,tune=native&quot;</span>)</span></span><br></pre></td></tr></table></figure>
<h2 id="modint"><a href="#modint" class="headerlink" title="modint"></a>modint</h2><p>取自后面博客的 tourist 的板子：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Cattle-Horse/p/16637943.html">https://www.cnblogs.com/Cattle-Horse/p/16637943.html</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注：使用这个需要把原来的 debug 注释掉</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">inv</span><span class="params">(<span class="type">const</span> T&amp; x, <span class="type">const</span> T&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(x != <span class="number">0</span>);</span><br><span class="line">    T u = <span class="number">0</span>, v = <span class="number">1</span>, a = x, m = y, t;</span><br><span class="line">    <span class="keyword">while</span> (a != <span class="number">0</span>) &#123;</span><br><span class="line">        t = m / a;</span><br><span class="line">        <span class="built_in">swap</span>(a, m -= t * a);</span><br><span class="line">        <span class="built_in">swap</span>(u -= t * v, v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">assert</span>(m == <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Modular</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> Type = <span class="keyword">typename</span> decay&lt;<span class="keyword">decltype</span>(T::value)&gt;::type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="title">Modular</span><span class="params">()</span> : value() &#123;</span>&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; <span class="built_in">Modular</span>(<span class="type">const</span> U&amp; x) &#123; value = <span class="built_in">normalize</span>(x); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    <span class="function"><span class="type">static</span> Type <span class="title">normalize</span><span class="params">(<span class="type">const</span> U&amp; x)</span> </span>&#123;</span><br><span class="line">        Type v = <span class="built_in">static_cast</span>&lt;Type&gt;((-<span class="built_in">mod</span>() &lt;= x &amp;&amp; x &lt; <span class="built_in">mod</span>()) ? x : x % <span class="built_in">mod</span>());</span><br><span class="line">        <span class="keyword">if</span> (v &lt; <span class="number">0</span>) v += <span class="built_in">mod</span>();</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> Type&amp; <span class="title">operator</span><span class="params">()</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">U</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;U&gt;(value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">static</span> Type <span class="title">mod</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> T::value; &#125;</span><br><span class="line"></span><br><span class="line">    Modular&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> Modular&amp; other) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((value += other.value) &gt;= <span class="built_in">mod</span>()) value -= <span class="built_in">mod</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Modular&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> Modular&amp; other) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((value -= other.value) &lt; <span class="number">0</span>) value += <span class="built_in">mod</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; Modular&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> U&amp; other) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> += <span class="built_in">Modular</span>(other); &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; Modular&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> U&amp; other) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> -= <span class="built_in">Modular</span>(other); &#125;</span><br><span class="line">    Modular&amp; <span class="keyword">operator</span>++() &#123; <span class="keyword">return</span> *<span class="keyword">this</span> += <span class="number">1</span>; &#125;</span><br><span class="line">    Modular&amp; <span class="keyword">operator</span>--() &#123; <span class="keyword">return</span> *<span class="keyword">this</span> -= <span class="number">1</span>; &#125;</span><br><span class="line">    Modular <span class="keyword">operator</span>++(<span class="type">int</span>) &#123;</span><br><span class="line">        <span class="function">Modular <span class="title">result</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">        *<span class="keyword">this</span> += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    Modular <span class="keyword">operator</span>--(<span class="type">int</span>) &#123;</span><br><span class="line">        <span class="function">Modular <span class="title">result</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">        *<span class="keyword">this</span> -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    Modular <span class="keyword">operator</span>-() <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>(-value); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U = T&gt;</span><br><span class="line">    <span class="keyword">typename</span> enable_if&lt;is_same&lt;<span class="keyword">typename</span> Modular&lt;U&gt;::Type, <span class="type">int</span>&gt;::value, Modular&gt;::type&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> Modular&amp; rhs) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line">        <span class="type">uint64_t</span> x = <span class="built_in">static_cast</span>&lt;<span class="type">int64_t</span>&gt;(value) * <span class="built_in">static_cast</span>&lt;<span class="type">int64_t</span>&gt;(rhs.value);</span><br><span class="line">        <span class="type">uint32_t</span> xh = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(x &gt;&gt; <span class="number">32</span>), xl = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(x), d, m;</span><br><span class="line">        <span class="built_in">asm</span>(</span><br><span class="line">            <span class="string">&quot;divl %4; \n\t&quot;</span></span><br><span class="line">            : <span class="string">&quot;=a&quot;</span>(d), <span class="string">&quot;=d&quot;</span>(m)</span><br><span class="line">            : <span class="string">&quot;d&quot;</span>(xh), <span class="string">&quot;a&quot;</span>(xl), <span class="string">&quot;r&quot;</span>(<span class="built_in">mod</span>()));</span><br><span class="line">        value = m;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        value = <span class="built_in">normalize</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int64_t</span>&gt;(value) * <span class="built_in">static_cast</span>&lt;<span class="type">int64_t</span>&gt;(rhs.value));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U = T&gt;</span><br><span class="line">    <span class="keyword">typename</span> enable_if&lt;is_same&lt;<span class="keyword">typename</span> Modular&lt;U&gt;::Type, <span class="type">long</span> <span class="type">long</span>&gt;::value, Modular&gt;::type&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> Modular&amp; rhs) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> q = <span class="built_in">static_cast</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(<span class="built_in">static_cast</span>&lt;<span class="type">long</span> <span class="type">double</span>&gt;(value) * rhs.value / <span class="built_in">mod</span>());</span><br><span class="line">        value = <span class="built_in">normalize</span>(value * rhs.value - q * <span class="built_in">mod</span>());</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U = T&gt;</span><br><span class="line">    <span class="keyword">typename</span> enable_if&lt;!is_integral&lt;<span class="keyword">typename</span> Modular&lt;U&gt;::Type&gt;::value, Modular&gt;::type&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> Modular&amp; rhs) &#123;</span><br><span class="line">        value = <span class="built_in">normalize</span>(value * rhs.value);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Modular&amp; <span class="keyword">operator</span>/=(<span class="type">const</span> Modular&amp; other) &#123; <span class="keyword">return</span> *<span class="keyword">this</span> *= <span class="built_in">Modular</span>(<span class="built_in">inv</span>(other.value, <span class="built_in">mod</span>())); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">const</span> Type&amp; <span class="title">abs</span><span class="params">(<span class="type">const</span> Modular&amp; x)</span> </span>&#123; <span class="keyword">return</span> x.value; &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Modular&lt;U&gt;&amp; lhs, <span class="type">const</span> Modular&lt;U&gt;&amp; rhs);</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt; <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Modular&lt;U&gt;&amp; lhs, <span class="type">const</span> Modular&lt;U&gt;&amp; rhs);</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, <span class="keyword">typename</span> U&gt; <span class="keyword">friend</span> V&amp; <span class="keyword">operator</span>&gt;&gt;(V&amp; stream, Modular&lt;U&gt;&amp; number);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Type value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> lhs.value == rhs.value; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, U rhs) &#123; <span class="keyword">return</span> lhs == <span class="built_in">Modular</span>&lt;T&gt;(rhs); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; <span class="type">bool</span> <span class="keyword">operator</span>==(U lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) == rhs; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> !(lhs == rhs); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, U rhs) &#123; <span class="keyword">return</span> !(lhs == rhs); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; <span class="type">bool</span> <span class="keyword">operator</span>!=(U lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> !(lhs == rhs); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> lhs.value &lt; rhs.value; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; Modular&lt;T&gt; <span class="keyword">operator</span>+(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) += rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>+(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, U rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) += rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>+(U lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) += rhs; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; Modular&lt;T&gt; <span class="keyword">operator</span>-(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) -= rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>-(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, U rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) -= rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>-(U lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) -= rhs; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; Modular&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) *= rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, U rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) *= rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>*(U lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) *= rhs; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; Modular&lt;T&gt; <span class="keyword">operator</span>/(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) /= rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>/(<span class="type">const</span> Modular&lt;T&gt;&amp; lhs, U rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) /= rhs; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt; Modular&lt;T&gt; <span class="keyword">operator</span>/(U lhs, <span class="type">const</span> Modular&lt;T&gt;&amp; rhs) &#123; <span class="keyword">return</span> <span class="built_in">Modular</span>&lt;T&gt;(lhs) /= rhs; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function">Modular&lt;T&gt; <span class="title">qpow</span><span class="params">(<span class="type">const</span> Modular&lt;T&gt;&amp; a, <span class="type">const</span> U&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(b &gt;= <span class="number">0</span>);</span><br><span class="line">    Modular&lt;T&gt; x = a, res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (T p = b; p; x *= x, p &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> (p &amp; <span class="number">1</span>) res *= x;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="type">bool</span> <span class="title">IsZero</span><span class="params">(<span class="type">const</span> Modular&lt;T&gt;&amp; number)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">number</span>() == <span class="number">0</span>; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function">string <span class="title">to_string</span><span class="params">(<span class="type">const</span> Modular&lt;T&gt;&amp; number)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">to_string</span>(<span class="built_in">number</span>()); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// U == std::ostream? but done this way because of fastoutput</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U, <span class="keyword">typename</span> T&gt; U&amp; <span class="keyword">operator</span>&lt;&lt;(U&amp; stream, <span class="type">const</span> Modular&lt;T&gt;&amp; number) &#123; <span class="keyword">return</span> stream &lt;&lt; <span class="built_in">number</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// U == std::istream? but done this way because of fastinput</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U, <span class="keyword">typename</span> T&gt;</span><br><span class="line">U&amp; <span class="keyword">operator</span>&gt;&gt;(U&amp; stream, Modular&lt;T&gt;&amp; number) &#123;</span><br><span class="line">    <span class="keyword">typename</span> common_type&lt;<span class="keyword">typename</span> Modular&lt;T&gt;::Type, <span class="type">long</span> <span class="type">long</span>&gt;::type x;</span><br><span class="line">    stream &gt;&gt; x;</span><br><span class="line">    number.value = Modular&lt;T&gt;::<span class="built_in">normalize</span>(x);</span><br><span class="line">    <span class="keyword">return</span> stream;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// using ModType = int;</span></span><br><span class="line"><span class="comment">// struct VarMod &#123; static ModType value; &#125;;</span></span><br><span class="line"><span class="comment">// ModType VarMod::value;</span></span><br><span class="line"><span class="comment">// ModType&amp; mod = VarMod::value;// for mod can change</span></span><br><span class="line"><span class="comment">// using Mint = Modular&lt;VarMod&gt;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> mod = (<span class="type">int</span>)<span class="number">1e9</span> + <span class="number">7</span>; </span><br><span class="line"><span class="keyword">using</span> Mint = Modular&lt;std::integral_constant&lt;decay&lt;<span class="keyword">decltype</span>(mod)&gt;::type, mod&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Fact</span> &#123;</span><br><span class="line">    vector&lt;Mint&gt; fact, factinv;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">Fact</span>(<span class="type">const</span> <span class="type">int</span>&amp; _n) : <span class="built_in">n</span>(_n), <span class="built_in">fact</span>(_n + <span class="number">1</span>, <span class="built_in">Mint</span>(<span class="number">1</span>)), <span class="built_in">factinv</span>(_n + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) fact[i] = fact[i - <span class="number">1</span>] * i;</span><br><span class="line">        factinv[n] = <span class="built_in">inv</span>(fact[n](), mod);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i; --i) factinv[i - <span class="number">1</span>] = factinv[i] * i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Mint <span class="title">C</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; n, <span class="type">const</span> <span class="type">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span> || k &lt; <span class="number">0</span> || n &lt; k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> fact[n] * factinv[k] * factinv[n - k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Mint <span class="title">A</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; n, <span class="type">const</span> <span class="type">int</span>&amp; k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span> || k &lt; <span class="number">0</span> || n &lt; k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> fact[n] * factinv[n - k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="调试-STL"><a href="#调试-STL" class="headerlink" title="调试 STL"></a>调试 STL</h2><p>我目前知道两种方法：</p>
<ol>
<li>使用 libstdc++ 的 debug code ，在 <a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/debug_mode_using.html">https://gcc.gnu.org/onlinedocs/libstdc++/manual/debug_mode_using.html</a> 中有详细介绍，大概意思是会将所用到的容易用能调试的容器替换，然后会在过程中自动检测各种合法性之类的，代价就是会变慢，甚至容器操作的复杂度会变劣。</li>
<li>写一个函数库，定义各种容器的输出，方便每次直接调用函数输出容器内容。</li>
</ol>
<h3 id="libstdc"><a href="#libstdc" class="headerlink" title="libstdc++"></a>libstdc++</h3><p>参考链接：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://ai2615.fstqwq.pw/debug/runtime/">https://ai2615.fstqwq.pw/debug/runtime/</a></li>
<li><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/debug_mode_using.html">https://gcc.gnu.org/onlinedocs/libstdc++/manual/debug_mode_using.html</a></li>
<li><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/debug_mode_semantics.html">https://gcc.gnu.org/onlinedocs/libstdc++/manual/debug_mode_semantics.html</a></li>
</ol>
<p>使用方式：编译时加上 <code>-D_GLIBCXX_DEBUG</code> 。</p>
<h3 id="函数库"><a href="#函数库" class="headerlink" title="函数库"></a>函数库</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DEBUG_TEMPLATE_CPP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG_TEMPLATE_CPP</span></span><br><span class="line"><span class="comment">// #define cerr cout</span></span><br><span class="line"><span class="keyword">namespace</span> __DEBUG_UTIL__ &#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="comment">/* Primitive Datatypes Print */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">bool</span> x)</span> </span>&#123; cerr &lt;&lt; (x ? <span class="string">&quot;T&quot;</span> : <span class="string">&quot;F&quot;</span>); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">char</span> x)</span> </span>&#123; cerr &lt;&lt; <span class="string">&#x27;\&#x27;&#x27;</span> &lt;&lt; x &lt;&lt; <span class="string">&#x27;\&#x27;&#x27;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">signed</span> <span class="type">short</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">signed</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">signed</span> <span class="type">long</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">signed</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">float</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">long</span> <span class="type">double</span> x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(string x)</span> </span>&#123; cerr &lt;&lt; <span class="string">&#x27;\&quot;&#x27;</span> &lt;&lt; x &lt;&lt; <span class="string">&#x27;\&quot;&#x27;</span>; &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="type">size_t</span> N&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(bitset&lt;N&gt; x)</span> </span>&#123; cerr &lt;&lt; x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(vector&lt;<span class="type">bool</span>&gt; v)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="comment">/* Overloaded this because stl optimizes vector&lt;bool&gt; by using</span></span><br><span class="line"><span class="comment">          _Bit_reference instead of bool to conserve space. */</span></span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;&#123;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;i : v)</span><br><span class="line">            cerr &lt;&lt; (f++ ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>) &lt;&lt; (i ? <span class="string">&quot;T&quot;</span> : <span class="string">&quot;F&quot;</span>);</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Templates Declarations to support nested datatypes */</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T &amp;&amp;x)</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(vector&lt;vector&lt;T&gt;&gt; mat)</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="type">size_t</span> N, <span class="type">size_t</span> M&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T (&amp;mat)[N][M])</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> S&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(pair&lt;F, S&gt; x)</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="type">size_t</span> N&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Tuple</span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Tuple</span>&lt;T, <span class="number">1</span>&gt;;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(tuple&lt;Args...&gt; t)</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(priority_queue&lt;T...&gt; pq)</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(stack&lt;T&gt; st)</span></span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(queue&lt;T&gt; q)</span></span>;</span><br><span class="line">    <span class="comment">/* Template Datatypes Definitions */</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T &amp;&amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/*  This works for every container that supports range-based loop</span></span><br><span class="line"><span class="comment">            i.e. vector, set, map, oset, omap, dequeue */</span></span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;&#123;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;i : x)</span><br><span class="line">            cerr &lt;&lt; (f++ ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="built_in">print</span>(i);</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(vector&lt;vector&lt;T&gt;&gt; mat)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;\n~~~~~\n&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;i : mat)</span><br><span class="line">        &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="built_in">setw</span>(<span class="number">2</span>) &lt;&lt; left &lt;&lt; f++, <span class="built_in">print</span>(i), cerr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;~~~~~\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="type">size_t</span> N, <span class="type">size_t</span> M&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T (&amp;mat)[N][M])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;\n~~~~~\n&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;i : mat)</span><br><span class="line">        &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="built_in">setw</span>(<span class="number">2</span>) &lt;&lt; left &lt;&lt; f++, <span class="built_in">print</span>(i), cerr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;~~~~~\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> S&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(pair&lt;F, S&gt; x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">        <span class="built_in">print</span>(x.first);</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">        <span class="built_in">print</span>(x.second);</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="type">size_t</span> N&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Tuple</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printTuple</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Tuple&lt;T, N - <span class="number">1</span>&gt;::<span class="built_in">printTuple</span>(t);</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;,&quot;</span>, <span class="built_in">print</span>(<span class="built_in">get</span>&lt;N - <span class="number">1</span>&gt;(t));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Tuple</span>&lt;T, <span class="number">1</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printTuple</span><span class="params">(T t)</span> </span>&#123; <span class="built_in">print</span>(<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(t)); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(tuple&lt;Args...&gt; t)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;(&quot;</span>;</span><br><span class="line">        Tuple&lt;<span class="keyword">decltype</span>(t), <span class="keyword">sizeof</span>...(Args)&gt;::<span class="built_in">printTuple</span>(t);</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(priority_queue&lt;T...&gt; pq)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;&#123;&#x27;</span>;</span><br><span class="line">        <span class="keyword">while</span> (!pq.<span class="built_in">empty</span>())</span><br><span class="line">            cerr &lt;&lt; (f++ ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="built_in">print</span>(pq.<span class="built_in">top</span>()), pq.<span class="built_in">pop</span>();</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(stack&lt;T&gt; st)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;&#123;&#x27;</span>;</span><br><span class="line">        <span class="keyword">while</span> (!st.<span class="built_in">empty</span>())</span><br><span class="line">            cerr &lt;&lt; (f++ ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="built_in">print</span>(st.<span class="built_in">top</span>()), st.<span class="built_in">pop</span>();</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(queue&lt;T&gt; q)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&#x27;&#123;&#x27;</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>())</span><br><span class="line">            cerr &lt;&lt; (f++ ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="built_in">print</span>(q.<span class="built_in">front</span>()), q.<span class="built_in">pop</span>();</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Printer functions */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printer</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *)</span> </span>&#123;&#125; <span class="comment">/* Base Recursive */</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... V&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printer</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *names, T &amp;&amp;head, V &amp;&amp;...tail)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/* Using &amp;&amp; to capture both lvalues and rvalues */</span></span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> bracket = <span class="number">0</span>; names[i] != <span class="string">&#x27;\0&#x27;</span> <span class="built_in">and</span> (names[i] != <span class="string">&#x27;,&#x27;</span> <span class="keyword">or</span> bracket != <span class="number">0</span>); i++)</span><br><span class="line">            <span class="keyword">if</span> (names[i] == <span class="string">&#x27;(&#x27;</span> <span class="keyword">or</span> names[i] == <span class="string">&#x27;&lt;&#x27;</span> <span class="keyword">or</span> names[i] == <span class="string">&#x27;&#123;&#x27;</span>)</span><br><span class="line">                bracket++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (names[i] == <span class="string">&#x27;)&#x27;</span> <span class="keyword">or</span> names[i] == <span class="string">&#x27;&gt;&#x27;</span> <span class="keyword">or</span> names[i] == <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">                bracket--;</span><br><span class="line">        cerr.<span class="built_in">write</span>(names, i) &lt;&lt; <span class="string">&quot; = &quot;</span>;</span><br><span class="line">        <span class="built_in">print</span>(head);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">sizeof</span>...(tail))</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot; ||&quot;</span>, <span class="built_in">printer</span>(names + i + <span class="number">1</span>, tail...);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* PrinterArr */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printerArr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *)</span> </span>&#123;&#125; <span class="comment">/* Base Recursive */</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... V&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printerArr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *names, T arr[], <span class="type">size_t</span> N, V... tail)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">size_t</span> ind = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; names[ind] <span class="keyword">and</span> names[ind] != <span class="string">&#x27;,&#x27;</span>; ind++)</span><br><span class="line">            cerr &lt;&lt; names[ind];</span><br><span class="line">        <span class="keyword">for</span> (ind++; names[ind] <span class="keyword">and</span> names[ind] != <span class="string">&#x27;,&#x27;</span>; ind++)</span><br><span class="line">            ;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot; = &#123;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            cerr &lt;&lt; (i ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="built_in">print</span>(arr[i]);</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">sizeof</span>...(tail))</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot; ||&quot;</span>, <span class="built_in">printerArr</span>(names + ind + <span class="number">1</span>, tail...);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) std::cerr &lt;&lt; __LINE__ &lt;&lt; <span class="string">&quot;: [&quot;</span>, __DEBUG_UTIL__::printer(#__VA_ARGS__, __VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debugArr(...) std::cerr &lt;&lt; __LINE__ &lt;&lt; <span class="string">&quot;: [&quot;</span>, __DEBUG_UTIL__::printerArr(#__VA_ARGS__, __VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debugArr(...)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __DEBUG_UTIL__;</span><br></pre></td></tr></table></figure>
<h2 id="小工具"><a href="#小工具" class="headerlink" title="小工具"></a>小工具</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用来输出 __int128_t 之类的东西。</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">autoprint</span><span class="params">(<span class="keyword">auto</span> x)</span></span>&#123;</span><br><span class="line">    string ans;</span><br><span class="line">    <span class="keyword">while</span>(x) ans += (x % <span class="number">10</span>) + <span class="string">&#x27;0&#x27;</span>, x /= <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">reverse</span>(ans.<span class="built_in">begin</span>(), ans.<span class="built_in">end</span>());</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="对拍"><a href="#对拍" class="headerlink" title="对拍"></a>对拍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">Case = <span class="number">0</span></span><br><span class="line">random.seed(<span class="number">999</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span> :</span><br><span class="line">    Case = Case + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;Case&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># T = 3</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;std.in&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f :</span><br><span class="line">        <span class="comment"># 数据生成</span></span><br><span class="line">        <span class="comment"># print(f&quot;&#123;T&#125;&quot;, file = f)</span></span><br><span class="line">        <span class="comment"># for i in range(T) :</span></span><br><span class="line">        <span class="comment">#     n = random.randint(1, 5)</span></span><br><span class="line">        <span class="comment">#     k = random.randint(1, 3)</span></span><br><span class="line">        <span class="comment">#     print(f&quot;&#123;n&#125; &#123;k&#125;&quot;, file = f)</span></span><br><span class="line">        <span class="comment">#     for j in range(n) :</span></span><br><span class="line">        <span class="comment">#         print(f&quot;&#123;random.randint(1, n)&#125;&quot;,end = &quot; &quot;, file = f)</span></span><br><span class="line">        <span class="comment">#     print(&quot;&quot;, file = f)</span></span><br><span class="line">        <span class="comment">#     for j in range(n) :</span></span><br><span class="line">        <span class="comment">#         print(f&quot;&#123;random.randint(1, j + 1)&#125;&quot;,end = &quot; &quot;, file = f)</span></span><br><span class="line">        <span class="comment">#     print(&quot;&quot;, file = f)</span></span><br><span class="line">    os.system(<span class="string">&quot;std &lt; std.in &gt; vio.out&quot;</span>)</span><br><span class="line">    os.system(<span class="string">&quot;vio &lt; std.in &gt; std.out&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> os.system(<span class="string">&quot;fc std.out vio.out&quot;</span>) != <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h1 id="数论"><a href="#数论" class="headerlink" title="数论"></a>数论</h1><h2 id="简单矩阵"><a href="#简单矩阵" class="headerlink" title="简单矩阵"></a>简单矩阵</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    LL a[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line">    <span class="built_in">Matrix</span>()&#123;<span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="built_in">sizeof</span>(a)); n = m = <span class="number">0</span>;&#125;</span><br><span class="line">    LL* <span class="keyword">operator</span>[](<span class="type">int</span> x)&#123;<span class="keyword">return</span> a[x];&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Matrix <span class="keyword">operator</span>+(Matrix x, Matrix y)&#123;</span><br><span class="line">    <span class="built_in">assert</span>(x.n == y.n &amp;&amp; x.m == y.m);</span><br><span class="line">    Matrix z;</span><br><span class="line">    z.n = x.n;</span><br><span class="line">    z.m = x.m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= z.n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= z.m; j++) z[i][j] = (x[i][j] + y[i][j]) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> z;</span><br><span class="line">&#125;</span><br><span class="line">Matrix <span class="keyword">operator</span>*(Matrix x, Matrix y)&#123;</span><br><span class="line">    <span class="built_in">assert</span>(x.m == y.n);</span><br><span class="line">    Matrix z;</span><br><span class="line">    z.n = x.n;</span><br><span class="line">    z.m = y.m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= z.n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= z.m; j++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>; k &lt;= x.m; k++)&#123;</span><br><span class="line">                z[i][j] = (z[i][j] + x[i][k] * y[k][j]) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Matrix <span class="title">unit</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    Matrix a; a.n = a.m = n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) a[i][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记得调用 hash_init</span></span><br><span class="line"><span class="comment">//typedef long long LL;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> __int128 U128;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">__int128_t</span> I128;</span><br><span class="line"><span class="type">const</span> LL P = <span class="number">992345234523451717</span>, A = <span class="number">311</span>;</span><br><span class="line">LL fA[N];</span><br><span class="line"><span class="type">static</span> <span class="keyword">constexpr</span> U128 inv = []() &#123;</span><br><span class="line">	U128 ret = P;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) ret *= <span class="number">2</span> - ret * P;</span><br><span class="line">	<span class="keyword">return</span> ret; &#125;();</span><br><span class="line"><span class="keyword">constexpr</span> U128 chk = <span class="built_in">U128</span>(<span class="number">-1</span>) / P;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(I128 a, I128 b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (a &lt; b) <span class="built_in">swap</span>(a, b);</span><br><span class="line">	<span class="keyword">return</span> (a - b) * inv &lt;= chk; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">hash_init</span><span class="params">(<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    fA[<span class="number">0</span>] = <span class="number">1ll</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; i++) fA[i] = (I128) fA[i - <span class="number">1</span>] * A % P;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Hash</span>&#123;</span><br><span class="line">    vector&lt;LL&gt; h;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">char</span> *tmp, <span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">        h.<span class="built_in">push_back</span>(<span class="number">0ll</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; i++) h.<span class="built_in">push_back</span>(((I128) h.<span class="built_in">back</span>() * A + tmp[i]) % P);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">const</span> string &amp;tmp)</span></span>&#123;</span><br><span class="line">        h.<span class="built_in">push_back</span>(<span class="number">0ll</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tmp.<span class="built_in">length</span>(); i++) h.<span class="built_in">push_back</span>(((I128) h.<span class="built_in">back</span>() * A + tmp[i - <span class="number">1</span>]) % P);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">I128 <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(l &lt;= r &amp;&amp; l &gt;= <span class="number">1</span> &amp;&amp; r &lt; h.<span class="built_in">size</span>());</span><br><span class="line">        <span class="keyword">return</span> h[r] - (I128) h[l - <span class="number">1</span>] * fA[r - l + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> V&gt; <span class="keyword">struct</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot, tr[V][<span class="number">26</span>];</span><br><span class="line">    <span class="built_in">Trie</span>() &#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *ch, <span class="type">int</span> slen)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= slen; i++) &#123;</span><br><span class="line">            <span class="type">int</span> x = ch[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!tr[now][x]) tr[now][x] = ++tot;</span><br><span class="line">            now = tr[now][x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="ACAM"><a href="#ACAM" class="headerlink" title="ACAM"></a>ACAM</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> ACAM&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> V = <span class="number">26</span>;</span><br><span class="line">    <span class="comment">/*如果题目给的是多个字符串而不是一个现成的Trie。</span></span><br><span class="line"><span class="comment">    那么last树的深度至多根号。*/</span></span><br><span class="line">    <span class="type">int</span> tr[N][V], last[N], fail[N], tot;</span><br><span class="line">    <span class="type">bool</span> v[N];</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">ins</span><span class="params">(<span class="type">char</span> *st, <span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; i++)&#123;</span><br><span class="line">            <span class="type">int</span> x = st[i] -<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!tr[now][x]) tr[now][x] = ++tot;</span><br><span class="line">            now = tr[now][x];</span><br><span class="line">        &#125;</span><br><span class="line">        v[now] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> now;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// lis还可以作为ACAM中任意一棵树的拓扑序。</span></span><br><span class="line">    <span class="comment">// 不过这个拓扑序里面没有0号点，也就是根。</span></span><br><span class="line">    <span class="type">int</span> lis[N], head, tail;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">        head = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; V; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (tr[<span class="number">0</span>][i])</span><br><span class="line">                lis[++tail] = tr[<span class="number">0</span>][i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(head &lt;= tail)&#123;</span><br><span class="line">            <span class="type">int</span> x = lis[head++];</span><br><span class="line">            <span class="keyword">if</span>(!v[fail[x]]) last[x] = last[fail[x]];</span><br><span class="line">            <span class="keyword">else</span> last[x] = fail[x];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; V; i++)&#123;</span><br><span class="line">                <span class="type">int</span> y = tr[x][i];</span><br><span class="line">                <span class="keyword">if</span> (!y) tr[x][i] = tr[fail[x]][i];</span><br><span class="line">                <span class="keyword">else</span> fail[y] = tr[fail[x]][i], lis[++tail] = y;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kmp</span><span class="params">(T *s, <span class="type">int</span> *fail, <span class="type">int</span> n)</span> </span>&#123; <span class="comment">// 1-based</span></span><br><span class="line">	fail[<span class="number">0</span>] = <span class="number">-1</span>; fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (j != <span class="number">-1</span> &amp;&amp; s[i] != s[j + <span class="number">1</span>]) j = fail[j];</span><br><span class="line">		fail[i] = ++j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kmp_match</span><span class="params">(T *s1, <span class="type">int</span> *fail, <span class="type">int</span> n, T *s2, <span class="type">int</span> *ans, <span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (j == n || (j != <span class="number">-1</span> &amp;&amp; s1[j + <span class="number">1</span>] != s2[i])) j = fail[j];</span><br><span class="line">		ans[i] = ++j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="EXKMP"><a href="#EXKMP" class="headerlink" title="EXKMP"></a>EXKMP</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exkmp</span><span class="params">(T *s, <span class="type">int</span> *fail, <span class="type">int</span> n)</span> </span>&#123; <span class="comment">// 1-based</span></span><br><span class="line">	fail[<span class="number">0</span>] = <span class="number">0</span>; fail[<span class="number">1</span>] = n;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		fail[i] = i &gt; r ? <span class="number">0</span> : <span class="built_in">min</span>(r - i + <span class="number">1</span>, fail[i - l + <span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">while</span> (i + fail[i] &lt;= n &amp;&amp; s[<span class="number">1</span> + fail[i]] == s[i + fail[i]]) fail[i]++;</span><br><span class="line">		<span class="keyword">if</span> (i + fail[i] - <span class="number">1</span> &gt; r) l = i, r = i + fail[i] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exkmp_match</span><span class="params">(T *s1, <span class="type">int</span> *fail, <span class="type">int</span> n, T *s2, <span class="type">int</span> *ans, <span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</span><br><span class="line">        ans[i] = i &gt; r ? <span class="number">0</span> : <span class="built_in">min</span>(r - i + <span class="number">1</span>, fail[i - l + <span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span> + ans[i] &lt;= n &amp;&amp; i + ans[i] &lt;= m &amp;&amp; s1[<span class="number">1</span> + ans[i]] == s2[i + ans[i]]) ans[i]++;</span><br><span class="line">		<span class="keyword">if</span> (i + ans[i] - <span class="number">1</span> &gt; r) l = i, r = i + ans[i] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">manachar</span><span class="params">(T *s1, T *s2, <span class="type">int</span> *fail, <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="comment">//	need clear : none</span></span><br><span class="line">	<span class="type">int</span> nn = n + n + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--) s2[i &lt;&lt; <span class="number">1</span>] = s1[i];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n + <span class="number">1</span>; i++) s2[(i &lt;&lt; <span class="number">1</span>) - <span class="number">1</span>] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">	<span class="type">int</span> now = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= nn; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (i &lt;= p) fail[i] = <span class="built_in">min</span>(p - i + <span class="number">1</span>, fail[now + now - i]);</span><br><span class="line">		<span class="keyword">else</span> fail[i] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (i + fail[i] - <span class="number">1</span> &gt;= p) &#123;</span><br><span class="line">			<span class="keyword">while</span> (i + fail[i] &lt;= nn &amp;&amp; i - fail[i] &gt;= <span class="number">1</span> &amp;&amp; s2[i + fail[i]] == s2[i - fail[i]]) fail[i]++;</span><br><span class="line">			now = i; p = i + fail[i] - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Lyndon-分解"><a href="#Lyndon-分解" class="headerlink" title="Lyndon 分解"></a>Lyndon 分解</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lyndon</span><span class="params">(<span class="keyword">auto</span> *s, <span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= n) &#123;</span><br><span class="line">        <span class="type">int</span> j = i + <span class="number">1</span>, k = i;</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= n &amp;&amp; s[k] &lt;= s[j]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[k] &lt; a[j]) k = i;</span><br><span class="line">            <span class="keyword">else</span> k++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= k) i += j - k; <span class="comment">//[i,i+j-k)即为对应的Lyndon分解 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SA"><a href="#SA" class="headerlink" title="SA"></a>SA</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SA : 需要清空的数组 height,h</span></span><br><span class="line"><span class="type">char</span> ss[N];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> cc[N], sa[N], xx[N], yy[N], top, V;</span><br><span class="line"><span class="type">int</span> rk[N], height[N], h[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getsa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	V = <span class="number">26</span>;</span><br><span class="line">	<span class="built_in">memset</span>(cc + <span class="number">1</span>, <span class="number">0</span>, V &lt;&lt; <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cc[xx[i] = ss[i] - <span class="string">&#x27;a&#x27;</span> + <span class="number">1</span>]++;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= V; i++) cc[i] += cc[i - <span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--) sa[cc[xx[i]]--] = i;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt; n; k &lt;&lt;= <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		top = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt; n - k; i--) yy[++top] = i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (sa[i] &gt; k) yy[++top] = sa[i] - k;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memset</span>(cc + <span class="number">1</span>, <span class="number">0</span>, V &lt;&lt; <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cc[xx[i]]++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= V; i++) cc[i] += cc[i - <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--) sa[cc[xx[yy[i]]]--] = yy[i];</span><br><span class="line">		<span class="built_in">swap</span>(xx, yy);</span><br><span class="line">		V = xx[sa[<span class="number">1</span>]] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) xx[sa[i]] = V += !(sa[i] + k &lt;= n &amp;&amp; sa[i - <span class="number">1</span>] + k &lt;= n &amp;&amp; yy[sa[i]] == yy[sa[i - <span class="number">1</span>]] &amp;&amp; yy[sa[i] + k] == yy[sa[i - <span class="number">1</span>] + k]);</span><br><span class="line">		<span class="keyword">if</span> (V == n) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) rk[sa[i]] = i;</span><br><span class="line">	<span class="type">int</span> now = <span class="number">0</span>;</span><br><span class="line">	ss[n + <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (now) now--;</span><br><span class="line">		<span class="keyword">if</span> (rk[i] == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">while</span> (ss[i + now] == ss[sa[rk[i] - <span class="number">1</span>] + now]) now++;</span><br><span class="line">		h[i] = now;</span><br><span class="line">		height[rk[i]] = now;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="PAM"><a href="#PAM" class="headerlink" title="PAM"></a>PAM</h2><h3 id="PAM-with-log-dp"><a href="#PAM-with-log-dp" class="headerlink" title="PAM with log dp"></a>PAM with log dp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000011</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">const</span> LL mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">char</span> st[N], ss[N];</span><br><span class="line"><span class="keyword">namespace</span> PAM &#123;</span><br><span class="line">	<span class="type">int</span> trans[N][<span class="number">26</span>], len[N], fail[N];</span><br><span class="line">	<span class="comment">// int dif[N], slink[N];</span></span><br><span class="line">	<span class="type">int</span> tot, last;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getfail</span><span class="params">(<span class="type">int</span> pos, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (pos - len[x] - <span class="number">1</span> &lt; <span class="number">1</span> || st[pos - len[x] - <span class="number">1</span>] != st[pos]) x = fail[x];</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		tot = last = <span class="number">1</span>;</span><br><span class="line">		len[<span class="number">1</span>] = <span class="number">-1</span>;</span><br><span class="line">		fail[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> x = <span class="built_in">getfail</span>(pos, last), c = st[pos] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span> (!trans[x][c]) &#123;</span><br><span class="line">			tot++;</span><br><span class="line">			len[tot] = len[x] + <span class="number">2</span>;</span><br><span class="line">			fail[tot] = trans[<span class="built_in">getfail</span>(pos, fail[x])][c];</span><br><span class="line">			trans[x][c] = tot;</span><br><span class="line">			<span class="comment">// dif[tot] = len[tot] - len[fail[tot]];</span></span><br><span class="line">			<span class="comment">// if (dif[tot] == dif[fail[tot]]) slink[tot] = slink[fail[tot]];</span></span><br><span class="line">			<span class="comment">// else slink[tot] = fail[tot];</span></span><br><span class="line">		&#125;</span><br><span class="line">		last = trans[x][c];</span><br><span class="line">	&#125;</span><br><span class="line">	LL g[N];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// using PAM::dif;</span></span><br><span class="line"><span class="comment">// using PAM::fail;</span></span><br><span class="line"><span class="comment">// using PAM::g;</span></span><br><span class="line"><span class="comment">// using PAM::len;</span></span><br><span class="line"><span class="comment">// using PAM::slink;</span></span><br><span class="line"><span class="comment">// int n;</span></span><br><span class="line"><span class="comment">// LL dp[N];</span></span><br><span class="line"><span class="comment">// int main() &#123;</span></span><br><span class="line"><span class="comment">// 	scanf(&quot;%s&quot;, ss + 1);</span></span><br><span class="line"><span class="comment">// 	n = strlen(ss + 1);</span></span><br><span class="line"><span class="comment">// 	for (int i = 1; i &lt;= n / 2; i++) st[i * 2 - 1] = ss[i], st[i * 2] = ss[n - i + 1];</span></span><br><span class="line"><span class="comment">// 	dp[0] = 1;</span></span><br><span class="line"><span class="comment">// 	PAM::init();</span></span><br><span class="line"><span class="comment">// 	for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line"><span class="comment">// 		PAM::add(i);</span></span><br><span class="line"><span class="comment">// 		for (int x = PAM::last; x &gt; 1; x = slink[x]) &#123;</span></span><br><span class="line"><span class="comment">// 			g[x] = dp[i - len[slink[x]] - dif[x]];</span></span><br><span class="line"><span class="comment">// 			if (dif[x] == dif[fail[x]]) g[x] = (g[x] + g[fail[x]]) % mod;</span></span><br><span class="line"><span class="comment">// 			if (i % 2 == 0) dp[i] = (dp[i] + g[x]) % mod;</span></span><br><span class="line"><span class="comment">// 		&#125;</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// 	printf(&quot;%lld\n&quot;, dp[n]);</span></span><br><span class="line"><span class="comment">// 	return 0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="广义-PAM"><a href="#广义-PAM" class="headerlink" title="广义 PAM"></a>广义 PAM</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_char_array</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> st[N];</span><br><span class="line">    cin &gt;&gt; st;</span><br><span class="line">    <span class="built_in">memcpy</span>(s + <span class="number">1</span>, st, <span class="built_in">sizeof</span>(<span class="type">char</span>) * (<span class="built_in">strlen</span>(st) + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> PAM &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> V1 = N;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> V2 = <span class="number">26</span>;</span><br><span class="line">    <span class="type">int</span> trans[V1][V2], quick[V1][V2], fail[V1], len[V1], tot;</span><br><span class="line">    <span class="type">int</span> ss[V1], slen;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        slen=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(trans[<span class="number">0</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(trans[<span class="number">0</span>])); <span class="built_in">memset</span>(quick[<span class="number">0</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(quick[<span class="number">0</span>]));</span><br><span class="line">        <span class="built_in">memset</span>(trans[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(trans[<span class="number">1</span>])); <span class="built_in">memset</span>(quick[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(quick[<span class="number">1</span>]));</span><br><span class="line">        tot = <span class="number">1</span>; len[<span class="number">1</span>] = <span class="number">-1</span>; fail[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; V2; i++) quick[<span class="number">0</span>][i] = quick[<span class="number">1</span>][i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getfail</span><span class="params">(<span class="type">int</span> pos, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pos - len[x] - <span class="number">1</span> &gt;= <span class="number">1</span> &amp;&amp; ss[pos - len[x] - <span class="number">1</span>] == ss[pos]) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> quick[x][ss[pos]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> c, <span class="type">int</span> last)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> pos = ++slen;</span><br><span class="line">        ss[slen] = c;</span><br><span class="line">        <span class="type">int</span> x = <span class="built_in">getfail</span>(pos, last);</span><br><span class="line">        <span class="keyword">if</span> (!trans[x][c]) &#123;</span><br><span class="line">            tot++;</span><br><span class="line">            <span class="built_in">memset</span>(trans[tot],<span class="number">0</span>,<span class="built_in">sizeof</span>(trans[tot]));</span><br><span class="line">            len[tot] = len[x] + <span class="number">2</span>;</span><br><span class="line">            fail[tot] = trans[quick[x][c]][c];</span><br><span class="line">            <span class="built_in">memcpy</span>(quick[tot], quick[fail[tot]], <span class="built_in">sizeof</span>(quick[tot]));</span><br><span class="line">            quick[tot][ss[pos - len[fail[tot]]]] = fail[tot];</span><br><span class="line">            trans[x][c] = tot;</span><br><span class="line">        &#125;</span><br><span class="line">        x = trans[x][c];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">()</span> </span>&#123; slen--; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> Trie &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> V1 = N;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> V2 = <span class="number">26</span>;</span><br><span class="line">    <span class="type">int</span> tr[V1][V2], fa[V1], type[V1];</span><br><span class="line">    <span class="type">int</span> last[V1], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; V2; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (y = tr[x][i]) &#123;</span><br><span class="line">                last[y] = PAM::<span class="built_in">add</span>(i, last[x], type[y]);</span><br><span class="line">                <span class="built_in">dfs</span>(y);</span><br><span class="line">                PAM::<span class="built_in">del</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PAM::<span class="built_in">init</span>();</span><br><span class="line">        last[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *ch, <span class="type">int</span> slen)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= slen; i++) &#123;</span><br><span class="line">            <span class="type">int</span> x = ch[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!tr[now][x]) tr[now][x] = ++tot;</span><br><span class="line">            now = tr[now][x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Trie::init();</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//Trie::build();</span></span><br></pre></td></tr></table></figure>
<h3 id="前后端插入的-PAM"><a href="#前后端插入的-PAM" class="headerlink" title="前后端插入的 PAM"></a>前后端插入的 PAM</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> PAM&#123;</span><br><span class="line">    <span class="type">int</span> trans[N][<span class="number">26</span>],fail[N],len[N];</span><br><span class="line">    <span class="type">int</span> tot,lastl,lastr;</span><br><span class="line">    <span class="type">int</span> ss[NN],L,R;</span><br><span class="line">    <span class="comment">//slen表示前端能够插入的最多字符数量。</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> slen)</span></span>&#123;</span><br><span class="line">        L=slen+<span class="number">1</span>;R=slen;</span><br><span class="line">        tot=lastl=lastr=<span class="number">1</span>;len[<span class="number">1</span>]=<span class="number">-1</span>;fail[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getfaill</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(pos+len[x]+<span class="number">1</span>&gt;R || ss[pos+len[x]+<span class="number">1</span>]!=ss[pos])x=fail[x];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getfailr</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(pos-len[x]<span class="number">-1</span>&lt;L || ss[pos-len[x]<span class="number">-1</span>]!=ss[pos])x=fail[x];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> c,<span class="type">int</span> type)</span></span>&#123;<span class="comment">//0 插在前面，1插在后面</span></span><br><span class="line">        <span class="type">int</span> x,pos;</span><br><span class="line">        <span class="keyword">if</span>(!type)ss[pos=--L]=c,x=<span class="built_in">getfaill</span>(pos,lastl);</span><br><span class="line">        <span class="keyword">else</span> ss[pos=++R]=c,x=<span class="built_in">getfailr</span>(pos,lastr);</span><br><span class="line">        <span class="keyword">if</span>(!trans[x][c])&#123;</span><br><span class="line">            tot++;</span><br><span class="line">            len[tot]=len[x]+<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(!type)fail[tot]=trans[<span class="built_in">getfaill</span>(pos,fail[x])][c];</span><br><span class="line">            <span class="keyword">else</span> fail[tot]=trans[<span class="built_in">getfailr</span>(pos,fail[x])][c];</span><br><span class="line">            trans[x][c]=tot;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!type)&#123;</span><br><span class="line">            lastl=trans[x][c];</span><br><span class="line">            <span class="keyword">if</span>(len[lastl]==R-L+<span class="number">1</span>)lastr=lastl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            lastr=trans[x][c];</span><br><span class="line">            <span class="keyword">if</span>(len[lastr]==R-L+<span class="number">1</span>)lastl=lastr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SAM"><a href="#SAM" class="headerlink" title="SAM"></a>SAM</h2><h3 id="单串SAM-with-拓扑排序"><a href="#单串SAM-with-拓扑排序" class="headerlink" title="单串SAM with 拓扑排序"></a>单串SAM with 拓扑排序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf(stderr, __VA_ARGS__)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_char_array</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> st[N];</span><br><span class="line">    cin &gt;&gt; st;</span><br><span class="line">    <span class="built_in">memcpy</span>(s + <span class="number">1</span>, st, <span class="built_in">sizeof</span>(<span class="type">char</span>) * (<span class="built_in">strlen</span>(st) + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//记得初始化</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> V1, <span class="type">int</span> V2&gt; <span class="keyword">struct</span> <span class="title class_">SAM</span> &#123;</span><br><span class="line">    <span class="comment">/*np就是一个前缀所在的节点，而且一个节点不可能同时包含两个前缀。</span></span><br><span class="line"><span class="comment">    拓扑序可以通过长度桶排得到。*/</span></span><br><span class="line">    <span class="type">int</span> trans[V1 * <span class="number">2</span>][V2], mxl[V1 * <span class="number">2</span>], fail[V1 * <span class="number">2</span>], tot, last;</span><br><span class="line">    <span class="type">int</span> cnt[V1 * <span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        tot = last = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(trans[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(trans[<span class="number">1</span>]));</span><br><span class="line">        cnt[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> p = last, np = last = ++tot;</span><br><span class="line">        </span><br><span class="line">        cnt[np] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(trans[np], <span class="number">0</span>, <span class="built_in">sizeof</span>(trans[np]));</span><br><span class="line">        mxl[np] = mxl[p] + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (; p &amp;&amp; !trans[p][c]; p = fail[p]) trans[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span> (!p) fail[np] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> q = trans[p][c];</span><br><span class="line">            <span class="keyword">if</span> (mxl[q] == mxl[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = ++tot; <span class="comment">// cnt[tot]=0;</span></span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                mxl[nq] = mxl[p] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(trans[nq], trans[q], <span class="built_in">sizeof</span>(trans[q]));</span><br><span class="line">                fail[np] = nq;</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; trans[p][c] == q; p = fail[p]) trans[p][c] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> cc[V1], qu[V1 * <span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        LL ans = <span class="number">0ll</span>;</span><br><span class="line">        <span class="built_in">memset</span>(cc, <span class="number">0</span>, (n + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tot; i++) cc[mxl[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cc[i] += cc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tot; i++) qu[cc[mxl[i]]--] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = tot; i &gt;= <span class="number">1</span>; i--)&#123;</span><br><span class="line">            <span class="type">int</span> x = qu[i];</span><br><span class="line">            <span class="built_in">assert</span>(fail[i] != i);</span><br><span class="line">            <span class="keyword">if</span>(x != <span class="number">1</span>) cnt[fail[x]] += cnt[x];</span><br><span class="line">            <span class="comment">// debug(&quot;%d %d\n&quot;, cnt[x], mxl[x]);</span></span><br><span class="line">            <span class="keyword">if</span>(cnt[x] != <span class="number">1</span>)&#123;</span><br><span class="line">                ans = <span class="built_in">max</span>(<span class="number">1ll</span> * cnt[x] * mxl[x], ans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">SAM&lt;N, <span class="number">26</span>&gt; sam;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> st[N];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// cin.sync_with_stdio(false);</span></span><br><span class="line">    <span class="comment">// cin.tie(0);</span></span><br><span class="line">    <span class="built_in">get_char_array</span>(st); n = <span class="built_in">strlen</span>(st + <span class="number">1</span>);</span><br><span class="line">    sam.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) sam.<span class="built_in">add</span>(st[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    sam.<span class="built_in">init</span>(n);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="在线-BFS-构建广义-SAM"><a href="#在线-BFS-构建广义-SAM" class="headerlink" title="在线 BFS 构建广义 SAM"></a>在线 BFS 构建广义 SAM</h3><p>所有广义 SAM 的代码来源均为：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/pm10t1pc">https://www.luogu.com.cn/article/pm10t1pc</a></p>
<p>作了小幅度修改。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> V1, <span class="type">int</span> V2&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SAM</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> tot, fail[V1 * <span class="number">2</span>], maxlen[V1 * <span class="number">2</span>], trans[V1 * <span class="number">2</span>][V2];</span><br><span class="line">    <span class="built_in">SAM</span>() &#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> c, <span class="type">int</span> last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (trans[last][c]) &#123;</span><br><span class="line">            <span class="type">int</span> p = last, q = trans[p][c];</span><br><span class="line">            <span class="keyword">if</span> (maxlen[p] + <span class="number">1</span> == maxlen[q]) <span class="keyword">return</span> q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = ++tot;</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                maxlen[nq] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(trans[nq], trans[q], <span class="built_in">sizeof</span>(trans[q]));</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; trans[p][c] == q; p = fail[p]) trans[p][c] = nq;</span><br><span class="line">                <span class="comment">// 可以直接复制下面的代码。</span></span><br><span class="line">                <span class="keyword">return</span> nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> p = last, np = ++tot;</span><br><span class="line">        maxlen[np] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; p &amp;&amp; !trans[p][c]; p = fail[p]) trans[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span> (!p) fail[np] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> q = trans[p][c];</span><br><span class="line">            <span class="keyword">if</span> (maxlen[q] == maxlen[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = ++tot;</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                maxlen[nq] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(trans[nq], trans[q], <span class="built_in">sizeof</span>(trans[q]));</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; trans[p][c] == q; p = fail[p])</span><br><span class="line">                    trans[p][c] = nq;</span><br><span class="line">                fail[np] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// scanf(&quot;%s&quot;,st+1);int slen=strlen(st+1);</span></span><br><span class="line"><span class="comment">// int last=1;</span></span><br><span class="line"><span class="comment">// for(int j=1;j&lt;=slen;j++)last=sam.insert(st[j]-&#x27;a&#x27;,last);</span></span><br></pre></td></tr></table></figure>
<h3 id="离线-DFS-构建广义-SAM"><a href="#离线-DFS-构建广义-SAM" class="headerlink" title="离线 DFS 构建广义 SAM"></a>离线 DFS 构建广义 SAM</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 1100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_char_array</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> st[M];</span><br><span class="line">    cin &gt;&gt; st;</span><br><span class="line">    <span class="built_in">memcpy</span>(s + <span class="number">1</span>, st, <span class="built_in">sizeof</span>(<span class="type">char</span>) * (<span class="built_in">strlen</span>(st) + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> V&gt; <span class="keyword">struct</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot, tr[V][<span class="number">26</span>];</span><br><span class="line">    <span class="built_in">Trie</span>() &#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *ch, <span class="type">int</span> slen)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= slen; i++) &#123;</span><br><span class="line">            <span class="type">int</span> x = ch[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!tr[now][x]) tr[now][x] = ++tot;</span><br><span class="line">            now = tr[now][x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Trie &lt;M&gt; trie;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> V1, <span class="type">int</span> V2&gt; <span class="keyword">struct</span> <span class="title class_">EXSAM</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot, pos[V1], fail[V1 * <span class="number">2</span>], maxlen[V1 * <span class="number">2</span>], trans[V1 * <span class="number">2</span>][V2];</span><br><span class="line">    <span class="built_in">EXSAM</span>() &#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> c, <span class="type">int</span> last)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (trans[last][c]) &#123;</span><br><span class="line">            <span class="type">int</span> p = last, q = trans[p][c];</span><br><span class="line">            <span class="keyword">if</span> (maxlen[p] + <span class="number">1</span> == maxlen[q]) <span class="keyword">return</span> q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = ++tot;</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                maxlen[nq] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(trans[nq], trans[q], <span class="built_in">sizeof</span>(trans[q]));</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; trans[p][c] == q; p = fail[p]) trans[p][c] = nq;</span><br><span class="line">                <span class="keyword">return</span> nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> p = last, np = ++tot;</span><br><span class="line">        maxlen[np] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; p &amp;&amp; !trans[p][c]; p = fail[p]) trans[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span> (!p) fail[np] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> q = trans[p][c];</span><br><span class="line">            <span class="keyword">if</span> (maxlen[q] == maxlen[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = ++tot;</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                maxlen[nq] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(trans[nq], trans[q], <span class="built_in">sizeof</span>(trans[q]));</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; trans[p][c] == q; p = fail[p])</span><br><span class="line">                    trans[p][c] = nq;</span><br><span class="line">                fail[np] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; V2; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (y = trie.tr[x][i]) pos[y] = <span class="built_in">insert</span>(i, pos[x]), <span class="built_in">dfs</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pos[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">LL <span class="title">getans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LL ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= tot; i++) ans += maxlen[i] - maxlen[fail[i]];</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> st[M];</span><br><span class="line">EXSAM &lt;M, <span class="number">26</span>&gt; sam;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">get_char_array</span>(st);</span><br><span class="line">        trie.<span class="built_in">insert</span>(st, <span class="built_in">strlen</span>(st + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    sam.<span class="built_in">build</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n%d\n&quot;</span>, sam.<span class="built_in">getans</span>(), sam.tot);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="离线-BFS-构建广义-SAM"><a href="#离线-BFS-构建广义-SAM" class="headerlink" title="离线 BFS 构建广义 SAM"></a>离线 BFS 构建广义 SAM</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 1100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_char_array</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> st[M];</span><br><span class="line">    cin &gt;&gt; st;</span><br><span class="line">    <span class="built_in">memcpy</span>(s + <span class="number">1</span>, st, <span class="built_in">sizeof</span>(<span class="type">char</span>) * (<span class="built_in">strlen</span>(st) + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> V&gt; <span class="keyword">struct</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot, tr[V][<span class="number">26</span>], fa[V], c[V];</span><br><span class="line">    <span class="built_in">Trie</span>() &#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *ch, <span class="type">int</span> slen)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= slen; i++) &#123;</span><br><span class="line">            <span class="type">int</span> x = ch[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!tr[now][x]) tr[now][x] = ++tot, c[tot] = x, fa[tot] = now;</span><br><span class="line">            now = tr[now][x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Trie &lt;M&gt; trie;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> V1, <span class="type">int</span> V2&gt; <span class="keyword">struct</span> <span class="title class_">EXSAM</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot, pos[V1], fail[V1 * <span class="number">2</span>], maxlen[V1 * <span class="number">2</span>], trans[V1 * <span class="number">2</span>][V2];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">    <span class="built_in">EXSAM</span>() &#123; tot = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> c, <span class="type">int</span> last)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> p = last, np = ++tot;</span><br><span class="line">        maxlen[np] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; p &amp;&amp; !trans[p][c]; p = fail[p]) trans[p][c] = np;</span><br><span class="line">        <span class="keyword">if</span> (!p) fail[np] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> q = trans[p][c];</span><br><span class="line">            <span class="keyword">if</span> (maxlen[q] == maxlen[p] + <span class="number">1</span>) fail[np] = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = ++tot;</span><br><span class="line">                fail[nq] = fail[q];</span><br><span class="line">                fail[q] = nq;</span><br><span class="line">                maxlen[nq] = maxlen[p] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(trans[nq], trans[q], <span class="built_in">sizeof</span>(trans[q]));</span><br><span class="line">                <span class="keyword">for</span> (; p &amp;&amp; trans[p][c] == q; p = fail[p]) trans[p][c] = nq;</span><br><span class="line">                fail[np] = nq;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> np;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pos[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; V2; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (trie.tr[<span class="number">1</span>][i]) Q.<span class="built_in">push</span>(trie.tr[<span class="number">1</span>][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> x = Q.<span class="built_in">front</span>();</span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            pos[x] = <span class="built_in">insert</span>(trie.c[x], pos[trie.fa[x]]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; V2; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (trie.tr[x][i]) Q.<span class="built_in">push</span>(trie.tr[x][i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">LL <span class="title">getans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LL ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= tot; i++) ans += maxlen[i] - maxlen[fail[i]];</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> st[M];</span><br><span class="line">EXSAM &lt;M, <span class="number">26</span>&gt; sam;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">get_char_array</span>(st);</span><br><span class="line">        trie.<span class="built_in">insert</span>(st, <span class="built_in">strlen</span>(st + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    sam.<span class="built_in">build</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n%d\n&quot;</span>, sam.<span class="built_in">getans</span>(), sam.tot);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Runs"><a href="#Runs" class="headerlink" title="Runs"></a>Runs</h2><h3 id="Hash-写法"><a href="#Hash-写法" class="headerlink" title="Hash 写法"></a>Hash 写法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;LL, LL&gt; PLL;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> LL mod = <span class="number">998244335</span>, base = <span class="number">29</span>;</span><br><span class="line"><span class="type">char</span> st[N];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Runs</span> &#123;</span><br><span class="line">    <span class="type">int</span> l, r, p;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;Runs&gt; run;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Runs x, Runs y)</span> </span>&#123; <span class="keyword">return</span> x.l != y.l ? x.l &lt; y.l : x.r &lt; y.r; &#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==(Runs x, Runs y) &#123; <span class="keyword">return</span> x.l == y.l &amp;&amp; x.r == y.r; &#125;</span><br><span class="line">LL fc[N], ff[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fc[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        fc[i] = fc[i - <span class="number">1</span>] * base % mod;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        ff[i] = (ff[i - <span class="number">1</span>] * base + st[i] - <span class="string">&#x27;A&#x27;</span> + <span class="number">1</span>) % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">gv</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="keyword">return</span> ((ff[r] - ff[l - <span class="number">1</span>] * fc[r - l + <span class="number">1</span>]) % mod + mod) % mod; &#125;</span><br><span class="line"><span class="function">LL <span class="title">gethash</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">gv</span>(l, r); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gl</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>, l = <span class="number">1</span>, r = <span class="built_in">min</span>(x, y);</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">gethash</span>(x - mid + <span class="number">1</span>, x) == <span class="built_in">gethash</span>(y - mid + <span class="number">1</span>, y))</span><br><span class="line">            ans = mid, l = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gr</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>, l = <span class="number">1</span>, r = <span class="built_in">min</span>(n - x + <span class="number">1</span>, n - y + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">gethash</span>(x, x + mid - <span class="number">1</span>) == <span class="built_in">gethash</span>(y, y + mid - <span class="number">1</span>))</span><br><span class="line">            ans = mid, l = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">getcmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">gr</span>(x, y);</span><br><span class="line">    <span class="keyword">return</span> st[x + len] &lt; st[y + len];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> ly[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lyndon</span><span class="params">(<span class="type">bool</span> type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    stack&lt;PII&gt; stk;</span><br><span class="line">    stk.<span class="built_in">push</span>(&#123;n, n&#125;);</span><br><span class="line">    ly[n] = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> now = i;</span><br><span class="line">        <span class="keyword">while</span> (!stk.<span class="built_in">empty</span>() &amp;&amp; <span class="built_in">getcmp</span>(i, stk.<span class="built_in">top</span>().first) != type)</span><br><span class="line">            now = stk.<span class="built_in">top</span>().second, stk.<span class="built_in">pop</span>();</span><br><span class="line">        ly[i] = now;</span><br><span class="line">        stk.<span class="built_in">push</span>(&#123;i, now&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getrun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= n; l++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> r = ly[l], ll = l, rr = r;</span><br><span class="line">        <span class="keyword">if</span> (l != <span class="number">1</span>)</span><br><span class="line">            ll -= <span class="built_in">gl</span>(l - <span class="number">1</span>, r);</span><br><span class="line">        <span class="keyword">if</span> (r != n)</span><br><span class="line">            rr += <span class="built_in">gr</span>(l, r + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (rr - ll + <span class="number">1</span> &gt;= <span class="number">2</span> * (r - l + <span class="number">1</span>))</span><br><span class="line">            run.<span class="built_in">push_back</span>(&#123;ll, rr, r - l + <span class="number">1</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, st + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(st + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> op = <span class="number">0</span>; op &lt;= <span class="number">1</span>; op++) &#123;</span><br><span class="line">        <span class="built_in">lyndon</span>(op);</span><br><span class="line">        <span class="built_in">getrun</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(run.<span class="built_in">begin</span>(),run.<span class="built_in">end</span>(),[](Runs x, Runs y) &#123;</span><br><span class="line">        <span class="keyword">return</span> x == y ? x.p &lt; y.p : (x.l != y.l ? x.l &lt; y.l : x.r &lt; y.r);&#125;);</span><br><span class="line">    run.<span class="built_in">erase</span>(<span class="built_in">unique</span>(run.<span class="built_in">begin</span>(), run.<span class="built_in">end</span>()), run.<span class="built_in">end</span>());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, run.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [l, r, p] : run)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, l, r, p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SA-写法"><a href="#SA-写法" class="headerlink" title="SA 写法"></a>SA 写法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Runs</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r,p;</span><br><span class="line">&#125;;vector&lt;Runs&gt; run;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==(Runs x,Runs y)&#123;<span class="keyword">return</span> x.l==y.l &amp;&amp; x.r==y.r;&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SA</span>&#123;</span><br><span class="line">    <span class="type">char</span> ss[N];</span><br><span class="line">    <span class="type">int</span> cc[N],sa[N],xx[N],yy[N],top,V;</span><br><span class="line">    <span class="type">int</span> rk[N],height[N],h[N],rmq[<span class="number">20</span>][N];</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        x=rk[x];y=rk[y];</span><br><span class="line">        <span class="keyword">if</span>(x&gt;y)<span class="built_in">swap</span>(x,y);</span><br><span class="line">        x++;<span class="type">int</span> k=__lg(y-x+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(rmq[k][x],rmq[k][y-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getcmp</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="comment">//x&lt;y</span></span><br><span class="line">        <span class="type">int</span> t=<span class="built_in">getlcp</span>(x,y);</span><br><span class="line">        <span class="keyword">return</span> ss[x+t]&lt;ss[y+t];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getsa</span><span class="params">()</span></span>&#123;</span><br><span class="line">        V=<span class="number">256</span>;<span class="built_in">memset</span>(cc+<span class="number">1</span>,<span class="number">0</span>,V&lt;&lt;<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cc[xx[i]=ss[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=V;i++)cc[i]+=cc[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--)sa[cc[xx[i]]--]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;n;k&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            top=<span class="number">0</span>;<span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;n-k;i--)yy[++top]=i;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(sa[i]&gt;k)yy[++top]=sa[i]-k;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">memset</span>(cc+<span class="number">1</span>,<span class="number">0</span>,V&lt;&lt;<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cc[xx[i]]++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=V;i++)cc[i]+=cc[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--)sa[cc[xx[yy[i]]]--]=yy[i];</span><br><span class="line">            <span class="built_in">swap</span>(xx,yy);</span><br><span class="line">            V=xx[sa[<span class="number">1</span>]]=<span class="number">1</span>;<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)xx[sa[i]]=V+=!(sa[i]+k&lt;=n &amp;&amp; sa[i<span class="number">-1</span>]+k&lt;=n &amp;&amp; yy[sa[i]]==yy[sa[i<span class="number">-1</span>]] &amp;&amp; yy[sa[i]+k]==yy[sa[i<span class="number">-1</span>]+k]);</span><br><span class="line">            <span class="keyword">if</span>(V==n)<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)rk[sa[i]]=i;</span><br><span class="line">        <span class="type">int</span> now=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(now)now--;</span><br><span class="line">            <span class="keyword">if</span>(rk[i]==<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">while</span>(ss[i+now]==ss[sa[rk[i]<span class="number">-1</span>]+now])now++;</span><br><span class="line">            h[i]=now;height[rk[i]]=now;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)rmq[<span class="number">0</span>][i]=height[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=__lg(n);i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=n-(<span class="number">1</span>&lt;&lt;i)+<span class="number">1</span>;j&gt;=<span class="number">1</span>;j--)rmq[i][j]=<span class="built_in">min</span>(rmq[i<span class="number">-1</span>][j],rmq[i<span class="number">-1</span>][j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;s0,s1;</span><br><span class="line"><span class="type">char</span> st[N];</span><br><span class="line"><span class="type">int</span> ly[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lyndon</span><span class="params">(<span class="type">bool</span> op)</span></span>&#123;</span><br><span class="line">    stack&lt;PII&gt; stk;stk.<span class="built_in">push</span>(&#123;n,n&#125;);ly[n]=n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="type">int</span> now=i;</span><br><span class="line">        <span class="keyword">while</span>(!stk.<span class="built_in">empty</span>() &amp;&amp; s0.<span class="built_in">getcmp</span>(i,stk.<span class="built_in">top</span>().first)!=op)now=stk.<span class="built_in">top</span>().second,stk.<span class="built_in">pop</span>();</span><br><span class="line">        ly[i]=now;</span><br><span class="line">        stk.<span class="built_in">push</span>(&#123;i,now&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getrun</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=n;l++)&#123;</span><br><span class="line">        <span class="type">int</span> r=ly[l],ll=l,rr=r;</span><br><span class="line">        <span class="keyword">if</span>(l!=<span class="number">1</span>)ll-=s1.<span class="built_in">getlcp</span>(n-r+<span class="number">1</span>,n-(l<span class="number">-1</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(r!=n)rr+=s0.<span class="built_in">getlcp</span>(l,r+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(rr-ll+<span class="number">1</span>&gt;=<span class="number">2</span>*(r-l+<span class="number">1</span>))run.<span class="built_in">push_back</span>(&#123;ll,rr,r-l+<span class="number">1</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,st+<span class="number">1</span>);n=<span class="built_in">strlen</span>(st+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// printf(&quot;%d %d %d\n&quot;,__lg(2),__lg(4),__lg(5));</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)s0.ss[i]=s1.ss[n-i+<span class="number">1</span>]=st[i];</span><br><span class="line">    st[n+<span class="number">1</span>]=s0.ss[n+<span class="number">1</span>]=s1.ss[n+<span class="number">1</span>]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    s0.<span class="built_in">getsa</span>();s1.<span class="built_in">getsa</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> op=<span class="number">0</span>;op&lt;=<span class="number">1</span>;op++)&#123;</span><br><span class="line">        <span class="built_in">lyndon</span>(op);</span><br><span class="line">        <span class="built_in">getrun</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(run.<span class="built_in">begin</span>(),run.<span class="built_in">end</span>(),[](Runs x, Runs y) &#123;</span><br><span class="line">        <span class="keyword">return</span> x == y ? x.p &lt; y.p : (x.l != y.l ? x.l &lt; y.l : x.r &lt; y.r);&#125;);</span><br><span class="line">    run.<span class="built_in">erase</span>(<span class="built_in">unique</span>(run.<span class="built_in">begin</span>(),run.<span class="built_in">end</span>()),run.<span class="built_in">end</span>());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,run.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> [l,r,p]:run)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,l,r,p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="简单线段树"><a href="#简单线段树" class="headerlink" title="简单线段树"></a>简单线段树</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">    <span class="type">int</span> lc, rc;</span><br><span class="line">    <span class="type">int</span> val, lazy;</span><br><span class="line">&#125;tr[N * <span class="number">2</span>]; <span class="type">int</span> cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(tr[x].lc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushlazy</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(tr[x].lc);</span><br><span class="line">    <span class="built_in">pushlazy</span>(tr[x].lc, tr[x].lazy);</span><br><span class="line">    <span class="built_in">pushlazy</span>(tr[x].rc, tr[x].lazy);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bt</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x = ++cnt;</span><br><span class="line">    tr[x].lc = tr[x].rc = tr[x].val = tr[x].lazy = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt; r)&#123;</span><br><span class="line">        <span class="type">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">        tr[x].lc = <span class="built_in">bt</span>(l, mid);</span><br><span class="line">        tr[x].rc = <span class="built_in">bt</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="built_in">update</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ll, <span class="type">int</span> rr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(rr &lt; l || ll &gt; r || ll &gt; rr) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(ll &lt;= l &amp;&amp; r &lt;= rr)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushdown</span>(x);</span><br><span class="line">    <span class="type">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">change</span>(tr[x].l, l, mid, ll, rr);</span><br><span class="line">    <span class="built_in">change</span>(tr[x].r, mid + <span class="number">1</span>, r, ll, rr);</span><br><span class="line">    <span class="built_in">update</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简单树状数组"><a href="#简单树状数组" class="headerlink" title="简单树状数组"></a>简单树状数组</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> x &amp; -x;&#125;</span><br><span class="line"><span class="type">int</span> bst[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(x &lt;= n)&#123;</span><br><span class="line">        bst[x] += k;</span><br><span class="line">        x += <span class="built_in">lowbit</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findans</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        ans += bst[x];</span><br><span class="line">        x -= <span class="built_in">lowbit</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> fa[N][SN], dep[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; e[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">18</span>; i++) fa[x][i] = fa[fa[x][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> y : e[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (y == fa[x][<span class="number">0</span>]) <span class="keyword">continue</span>;</span><br><span class="line">		dep[y] = dep[x] + <span class="number">1</span>;</span><br><span class="line">		fa[y][<span class="number">0</span>] = x;</span><br><span class="line">		<span class="built_in">dfs</span>(y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findlca</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (dep[x] &gt; dep[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">18</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dep[fa[y][i]] &gt;= dep[x]) y = fa[y][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (x == y) <span class="keyword">return</span> x;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">18</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (fa[x][i] != fa[y][i]) x = fa[x][i], y = fa[y][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fa[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简单树链剖分"><a href="#简单树链剖分" class="headerlink" title="简单树链剖分"></a>简单树链剖分</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; e[N];</span><br><span class="line"><span class="type">int</span> siz[N], zs[N], fa[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">findzs</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    siz[x] = <span class="number">1</span>; zs[x] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> y : e[x])&#123;</span><br><span class="line">        <span class="keyword">if</span>(y == fa[x]) <span class="keyword">continue</span>;</span><br><span class="line">        fa[y] = x;</span><br><span class="line">        <span class="built_in">findzs</span>(y);</span><br><span class="line">        siz[x] += siz[y];</span><br><span class="line">        <span class="keyword">if</span>(siz[y] &gt; siz[zs[x]]) zs[x] = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> lt[N], dfn[N], ti, stk[N], dl[N], dr[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getl</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f)</span></span>&#123;</span><br><span class="line">    lt[x] = f;</span><br><span class="line">    stk[dfn[x] = ++ti] = x;</span><br><span class="line">    dl[x] = ti;</span><br><span class="line">    <span class="keyword">if</span>(zs[x]) <span class="built_in">getl</span>(zs[x], f);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> [y, c] : e[x])&#123;</span><br><span class="line">        <span class="keyword">if</span>(y == fa[x] || y == zs[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">getl</span>(y, y);</span><br><span class="line">    &#125;</span><br><span class="line">    dr[x] = ti;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h1><h2 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> poly = vector&lt;<span class="type">int</span>&gt;;</span><br><span class="line">poly omega[<span class="number">25</span>]; <span class="comment">// 单位根</span></span><br><span class="line"><span class="comment">// n 是 DFT 的最大长度，例如如果最多有两个长为 m 的多项式相乘，</span></span><br><span class="line"><span class="comment">// 或者求逆的长度为 m，那么 n 需要 &gt;= 2m</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt_init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="comment">// n = 2^k</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">2</span>, d = <span class="number">0</span>; k &lt;= n; k *= <span class="number">2</span>, d++) &#123;</span><br><span class="line">		omega[d].<span class="built_in">resize</span>(k + <span class="number">1</span>);</span><br><span class="line">		<span class="type">int</span> wn = <span class="built_in">ksm</span>(<span class="number">3</span>, (mod - <span class="number">1</span>) / k), tmp = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; i++) &#123; omega[d][i] = tmp;</span><br><span class="line">			tmp = (LL)tmp * wn % mod; &#125; &#125; &#125;</span><br><span class="line"><span class="comment">// 传入的数必须是 [0, mod) 范围内，不能有负的</span></span><br><span class="line"><span class="comment">// 否则把 d == 16 改成 d % 8 == 0 之类，多取几次模</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *c, <span class="type">int</span> n, <span class="type">int</span> tp)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(n &lt;= (<span class="number">1</span> &lt;&lt; <span class="number">16</span>));</span><br><span class="line">	<span class="type">static</span> ULL a[N];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] = c[i];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">		<span class="type">int</span> k = n; <span class="keyword">do</span> j ^= (k &gt;&gt;= <span class="number">1</span>); <span class="keyword">while</span> (j &lt; k);</span><br><span class="line">		<span class="keyword">if</span> (i &lt; j) <span class="built_in">swap</span>(a[i], a[j]); &#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>, d = <span class="number">0</span>; k &lt; n; k *= <span class="number">2</span>, d++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (d == <span class="number">16</span>) <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] %= mod;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i += k * <span class="number">2</span>)</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; k; j++) &#123;</span><br><span class="line">				<span class="type">int</span> w = omega[d][tp &gt; <span class="number">0</span> ? j : k * <span class="number">2</span> - j];</span><br><span class="line">				ULL u = a[i + j], v = w * a[i + j + k] % mod;</span><br><span class="line">				a[i + j] = u + v;</span><br><span class="line">				a[i + j + k] = u - v + mod; &#125; &#125;</span><br><span class="line">	<span class="keyword">if</span> (tp&gt;<span class="number">0</span>) &#123;<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) c[i] = a[i] % mod;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="type">int</span> inv = <span class="built_in">ksm</span>(n, mod - <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) c[i] = a[i] * inv % mod;&#125;&#125;</span><br><span class="line"><span class="function">poly <span class="title">poly_auto_mul</span><span class="params">(poly a, poly b)</span> </span>&#123; <span class="comment">// 自动判断长度的乘法</span></span><br><span class="line">    <span class="keyword">if</span>(a.<span class="built_in">size</span>() &lt; b.<span class="built_in">size</span>()) <span class="built_in">swap</span>(a, b);</span><br><span class="line">    <span class="keyword">if</span>(b.<span class="built_in">size</span>() &lt;= <span class="number">100</span>)&#123;</span><br><span class="line">        <span class="function">poly <span class="title">c</span><span class="params">(a.size() + b.size() - <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; b.<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">                c[i + j] = (c[i + j] + <span class="number">1ll</span> * a[i] * b[j]) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res_len = (<span class="type">int</span>)a.<span class="built_in">size</span>() + (<span class="type">int</span>)b.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ntt_n = <span class="number">1</span>; <span class="keyword">while</span> (ntt_n &lt; res_len) ntt_n *= <span class="number">2</span>;</span><br><span class="line">    a.<span class="built_in">resize</span>(ntt_n); b.<span class="built_in">resize</span>(ntt_n);</span><br><span class="line">    <span class="built_in">ntt</span>(a.<span class="built_in">data</span>(), ntt_n, <span class="number">1</span>); <span class="built_in">ntt</span>(b.<span class="built_in">data</span>(), ntt_n, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ntt_n; i++)</span><br><span class="line">        a[i] = (LL)a[i] * b[i] % mod;</span><br><span class="line">    <span class="built_in">ntt</span>(a.<span class="built_in">data</span>(), ntt_n, <span class="number">-1</span>); a.<span class="built_in">resize</span>(res_len); <span class="keyword">return</span> a; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="半在线卷积-NTT"><a href="#半在线卷积-NTT" class="headerlink" title="半在线卷积 NTT"></a>半在线卷积 NTT</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> poly = vector&lt;<span class="type">int</span>&gt;;</span><br><span class="line">poly omega[<span class="number">25</span>]; <span class="comment">// 单位根</span></span><br><span class="line"><span class="comment">// n 是 DFT 的最大长度，例如如果最多有两个长为 m 的多项式相乘，</span></span><br><span class="line"><span class="comment">// 或者求逆的长度为 m，那么 n 需要 &gt;= 2m</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt_init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="comment">// n = 2^k</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">2</span>, d = <span class="number">0</span>; k &lt;= n; k *= <span class="number">2</span>, d++) &#123;</span><br><span class="line">		omega[d].<span class="built_in">resize</span>(k + <span class="number">1</span>);</span><br><span class="line">		<span class="type">int</span> wn = <span class="built_in">ksm</span>(<span class="number">3</span>, (mod - <span class="number">1</span>) / k), tmp = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; i++) &#123; omega[d][i] = tmp;</span><br><span class="line">			tmp = (LL)tmp * wn % mod; &#125; &#125; &#125;</span><br><span class="line"><span class="comment">// 传入的数必须是 [0, mod) 范围内，不能有负的</span></span><br><span class="line"><span class="comment">// 否则把 d == 16 改成 d % 8 == 0 之类，多取几次模</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *c, <span class="type">int</span> n, <span class="type">int</span> tp)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(n &lt;= (<span class="number">1</span> &lt;&lt; <span class="number">16</span>));</span><br><span class="line">	<span class="type">static</span> ULL a[N];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] = c[i];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">		<span class="type">int</span> k = n; <span class="keyword">do</span> j ^= (k &gt;&gt;= <span class="number">1</span>); <span class="keyword">while</span> (j &lt; k);</span><br><span class="line">		<span class="keyword">if</span> (i &lt; j) <span class="built_in">swap</span>(a[i], a[j]); &#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>, d = <span class="number">0</span>; k &lt; n; k *= <span class="number">2</span>, d++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (d == <span class="number">16</span>) <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) a[i] %= mod;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i += k * <span class="number">2</span>)</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; k; j++) &#123;</span><br><span class="line">				<span class="type">int</span> w = omega[d][tp &gt; <span class="number">0</span> ? j : k * <span class="number">2</span> - j];</span><br><span class="line">				ULL u = a[i + j], v = w * a[i + j + k] % mod;</span><br><span class="line">				a[i + j] = u + v;</span><br><span class="line">				a[i + j + k] = u - v + mod; &#125; &#125;</span><br><span class="line">	<span class="keyword">if</span> (tp&gt;<span class="number">0</span>) &#123;<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) c[i] = a[i] % mod;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="type">int</span> inv = <span class="built_in">ksm</span>(n, mod - <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) c[i] = a[i] * inv % mod;&#125;&#125;</span><br><span class="line"><span class="function">poly <span class="title">poly_auto_mul</span><span class="params">(poly a, poly b)</span> </span>&#123; <span class="comment">// 自动判断长度的乘法</span></span><br><span class="line">    <span class="keyword">if</span>(a.<span class="built_in">size</span>() &lt; b.<span class="built_in">size</span>()) <span class="built_in">swap</span>(a, b);</span><br><span class="line">    <span class="keyword">if</span>(b.<span class="built_in">size</span>() &lt;= <span class="number">100</span>)&#123;</span><br><span class="line">        <span class="function">poly <span class="title">c</span><span class="params">(a.size() + b.size() - <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; b.<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">                c[i + j] = (c[i + j] + <span class="number">1ll</span> * a[i] * b[j]) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res_len = (<span class="type">int</span>)a.<span class="built_in">size</span>() + (<span class="type">int</span>)b.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ntt_n = <span class="number">1</span>; <span class="keyword">while</span> (ntt_n &lt; res_len) ntt_n *= <span class="number">2</span>;</span><br><span class="line">    a.<span class="built_in">resize</span>(ntt_n); b.<span class="built_in">resize</span>(ntt_n);</span><br><span class="line">    <span class="built_in">ntt</span>(a.<span class="built_in">data</span>(), ntt_n, <span class="number">1</span>); <span class="built_in">ntt</span>(b.<span class="built_in">data</span>(), ntt_n, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ntt_n; i++)</span><br><span class="line">        a[i] = (LL)a[i] * b[i] % mod;</span><br><span class="line">    <span class="built_in">ntt</span>(a.<span class="built_in">data</span>(), ntt_n, <span class="number">-1</span>); a.<span class="built_in">resize</span>(res_len); <span class="keyword">return</span> a; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solveg</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solveg</span>(l, mid);</span><br><span class="line">    &#123;</span><br><span class="line">        poly lg, rg;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = l; i &lt;= mid; i++) lg.<span class="built_in">push_back</span>(g[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= r - l; i++) rg.<span class="built_in">push_back</span>(fc[i]);</span><br><span class="line">        poly ans = <span class="built_in">poly_auto_mul</span>(lg, rg);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = mid + <span class="number">1</span>; i &lt;= r; i++) g[i] = (g[i] - ans[i - (l + <span class="number">1</span>)] + mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">solveg</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FWT"><a href="#FWT" class="headerlink" title="FWT"></a>FWT</h2><h1 id="图论-1"><a href="#图论-1" class="headerlink" title="图论"></a>图论</h1><h2 id="带花树（一般图最大匹配）"><a href="#带花树（一般图最大匹配）" class="headerlink" title="带花树（一般图最大匹配）"></a>带花树（一般图最大匹配）</h2><p>代码来源：<a target="_blank" rel="noopener" href="https://uoj.ac/submission/412225">https://uoj.ac/submission/412225</a></p>
<p>但我小改了一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> V&gt; <span class="keyword">struct</span> <span class="title class_">blossom_tree</span>&#123;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt; &gt; e;</span><br><span class="line">    <span class="type">int</span> pre[V], tim;</span><br><span class="line">    <span class="type">int</span> h[V], tot;</span><br><span class="line">    <span class="type">int</span> match[V], f[V], tp[V], tic[V];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">    <span class="built_in">blossom_tree</span>()&#123;</span><br><span class="line">        e.<span class="built_in">resize</span>(V);</span><br><span class="line">        tim = tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(pre, <span class="number">0</span>, <span class="built_in">sizeof</span>(pre));</span><br><span class="line">        <span class="built_in">memset</span>(h, <span class="number">0</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line">        <span class="built_in">memset</span>(match, <span class="number">0</span>, <span class="built_in">sizeof</span>(match));</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="built_in">sizeof</span>(f));</span><br><span class="line">        <span class="built_in">memset</span>(tp, <span class="number">0</span>, <span class="built_in">sizeof</span>(tp));</span><br><span class="line">        <span class="built_in">memset</span>(tic, <span class="number">0</span>, <span class="built_in">sizeof</span>(tic));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f[x] == x ? f[x] : f[x] = <span class="built_in">find</span>(f[x]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        e[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        e[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (++tim;; <span class="built_in">swap</span>(x, y)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x) &#123;</span><br><span class="line">                x = <span class="built_in">find</span>(x);</span><br><span class="line">                <span class="keyword">if</span> (tic[x] == tim) <span class="keyword">return</span> x;</span><br><span class="line">                <span class="keyword">else</span> tic[x] = tim, x = pre[match[x]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">shrink</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">find</span>(x) != p) &#123;</span><br><span class="line">            pre[x] = y, y = match[x];</span><br><span class="line">            <span class="keyword">if</span> (tp[y] == <span class="number">2</span>) tp[y] = <span class="number">1</span>, que.<span class="built_in">push</span>(y);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">find</span>(x) == x) f[x] = p;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">find</span>(y) == y) f[y] = p;</span><br><span class="line">            x = pre[y];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">aug</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) f[i] = i;</span><br><span class="line">        <span class="built_in">memset</span>(tp, <span class="number">0</span>, <span class="built_in">sizeof</span>(tp)), <span class="built_in">memset</span>(pre, <span class="number">0</span>, <span class="built_in">sizeof</span>(pre));</span><br><span class="line">        <span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) que.<span class="built_in">pop</span>();</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        tp[s] = <span class="number">1</span>; <span class="comment">// 1: type A ; 2: type B</span></span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> x = que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[x]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">find</span>(v) == <span class="built_in">find</span>(x) || tp[v] == <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (!tp[v]) &#123;</span><br><span class="line">                    tp[v] = <span class="number">2</span>, pre[v] = x;</span><br><span class="line">                    <span class="keyword">if</span> (!match[v]) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> now = v, last, tmp; now; now = last) &#123;</span><br><span class="line">                            last = match[tmp = pre[now]];</span><br><span class="line">                            match[now] = tmp, match[tmp] = now;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    tp[match[v]] = <span class="number">1</span>, que.<span class="built_in">push</span>(match[v]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (tp[v] == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> l = <span class="built_in">lca</span>(x, v);</span><br><span class="line">                    <span class="built_in">shrink</span>(x, v, l);</span><br><span class="line">                    <span class="built_in">shrink</span>(v, x, l);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) ans += (!match[i] &amp;&amp; <span class="built_in">aug</span>(i, n));</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e2</span> + <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    blossom_tree&lt;N&gt; b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">        b.<span class="built_in">add</span>(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; b.<span class="built_in">solve</span>(n) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) cout &lt;&lt; b.match[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="带权带花树（一般图最大权匹配）"><a href="#带权带花树（一般图最大权匹配）" class="headerlink" title="带权带花树（一般图最大权匹配）"></a>带权带花树（一般图最大权匹配）</h2><p>代码来源：<a target="_blank" rel="noopener" href="https://uoj.ac/submission/540763">https://uoj.ac/submission/540763</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="type">int</span> V&gt; <span class="keyword">struct</span> <span class="title class_">weighted_blossom_tree</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum</span> &#123; N = V * <span class="number">2</span> &#125;;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> T inf = numeric_limits&lt;T&gt;::<span class="built_in">max</span>() &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">Q</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> u, v;</span><br><span class="line">		T w;</span><br><span class="line">	&#125; e[N][N];</span><br><span class="line">	T lab[N];</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> T <span class="title">d</span><span class="params">(<span class="type">const</span> Q &amp;x)</span> </span>&#123; <span class="keyword">return</span> lab[x.u] + lab[x.v] - e[x.u][x.v].w * <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> n, m, id, h, t;</span><br><span class="line">	<span class="type">int</span> lk[N], sl[N], st[N], f[N], b[N][N], s[N], ed[N], q[N];</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; p[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!sl[v] || <span class="built_in">d</span>(e[u][v]) &lt; <span class="built_in">d</span>(e[sl[v]][v]))</span><br><span class="line">			sl[v] = u;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ss</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		sl[v] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">1</span>; u &lt;= n; u++)</span><br><span class="line">			<span class="keyword">if</span> (e[u][v].w &gt; <span class="number">0</span> &amp;&amp; st[u] != v &amp;&amp; !s[st[u]])</span><br><span class="line">				<span class="built_in">upd</span>(u, v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (u &lt;= n)</span><br><span class="line">			q[++t] = u;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> v : p[u])</span><br><span class="line">				<span class="built_in">ins</span>(v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">mdf</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		st[u] = w;</span><br><span class="line">		<span class="keyword">if</span> (u &gt; n)</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> v : p[u])</span><br><span class="line">				<span class="built_in">mdf</span>(v, w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">gr</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		v = <span class="built_in">find</span>(p[u].<span class="built_in">begin</span>(), p[u].<span class="built_in">end</span>(), v) - p[u].<span class="built_in">begin</span>();</span><br><span class="line">		<span class="keyword">if</span> (v &amp; <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="built_in">reverse</span>(p[u].<span class="built_in">begin</span>() + <span class="number">1</span>, p[u].<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">return</span> (<span class="type">int</span>)p[u].<span class="built_in">size</span>() - v;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">stm</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		lk[u] = e[u][v].v;</span><br><span class="line">		<span class="keyword">if</span> (u &lt;= n)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		Q w = e[u][v];</span><br><span class="line">		<span class="type">int</span> x = b[u][w.u], y = <span class="built_in">gr</span>(u, x);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; y; i++)</span><br><span class="line">			<span class="built_in">stm</span>(p[u][i], p[u][i ^ <span class="number">1</span>]);</span><br><span class="line">		<span class="built_in">stm</span>(x, v);</span><br><span class="line">		<span class="built_in">rotate</span>(p[u].<span class="built_in">begin</span>(), p[u].<span class="built_in">begin</span>() + y, p[u].<span class="built_in">end</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">aug</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> w = st[lk[u]];</span><br><span class="line">		<span class="built_in">stm</span>(u, v);</span><br><span class="line">		<span class="keyword">if</span> (!w)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">stm</span>(w, st[f[w]]);</span><br><span class="line">		<span class="built_in">aug</span>(st[f[w]], w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (++id; u || v; <span class="built_in">swap</span>(u, v)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!u)</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (ed[u] == id)</span><br><span class="line">				<span class="keyword">return</span> u;</span><br><span class="line">			ed[u] = id;</span><br><span class="line">			<span class="keyword">if</span> (u = st[lk[u]])</span><br><span class="line">				u = st[f[u]];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> a, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> x = n + <span class="number">1</span>, i, j;</span><br><span class="line">		<span class="keyword">while</span> (x &lt;= m &amp;&amp; st[x])</span><br><span class="line">			++x;</span><br><span class="line">		<span class="keyword">if</span> (x &gt; m)</span><br><span class="line">			++m;</span><br><span class="line">		lab[x] = s[x] = st[x] = <span class="number">0</span>;</span><br><span class="line">		lk[x] = lk[a];</span><br><span class="line">		p[x].<span class="built_in">clear</span>();</span><br><span class="line">		p[x].<span class="built_in">push_back</span>(a);</span><br><span class="line">		<span class="keyword">for</span> (i = u; i != a; i = st[f[j]]) &#123;</span><br><span class="line">			p[x].<span class="built_in">push_back</span>(i);</span><br><span class="line">			j = st[lk[i]];</span><br><span class="line">			p[x].<span class="built_in">push_back</span>(j);</span><br><span class="line">			<span class="built_in">ins</span>(j);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">reverse</span>(p[x].<span class="built_in">begin</span>() + <span class="number">1</span>, p[x].<span class="built_in">end</span>());</span><br><span class="line">		<span class="keyword">for</span> (i = v; i != a; i = st[f[j]]) &#123;</span><br><span class="line">			p[x].<span class="built_in">push_back</span>(i);</span><br><span class="line">			j = st[lk[i]];</span><br><span class="line">			p[x].<span class="built_in">push_back</span>(j);</span><br><span class="line">			<span class="built_in">ins</span>(j);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">mdf</span>(x, x);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">			e[x][i].w = e[i][x].w = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">memset</span>(b[x] + <span class="number">1</span>, <span class="number">0</span>, n * <span class="keyword">sizeof</span> b[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> u : p[x]) &#123;</span><br><span class="line">			<span class="keyword">for</span> (v = <span class="number">1</span>; v &lt;= m; v++)</span><br><span class="line">				<span class="keyword">if</span> (!e[x][v].w || <span class="built_in">d</span>(e[u][v]) &lt; <span class="built_in">d</span>(e[x][v])) &#123;</span><br><span class="line">					e[x][v] = e[u][v];</span><br><span class="line">					e[v][x] = e[v][u];</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">for</span> (v = <span class="number">1</span>; v &lt;= n; v++)</span><br><span class="line">				<span class="keyword">if</span> (b[u][v])</span><br><span class="line">					b[x][v] = u;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">ss</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ex</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">assert</span>(s[u] == <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> x : p[u])</span><br><span class="line">			<span class="built_in">mdf</span>(x, x);</span><br><span class="line">		<span class="type">int</span> a = b[u][e[u][f[u]].u];</span><br><span class="line">		<span class="type">int</span> r = <span class="built_in">gr</span>(u, a);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; r; i += <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="type">int</span> x = p[u][i], y = p[u][i + <span class="number">1</span>];</span><br><span class="line">			f[x] = e[y][x].u;</span><br><span class="line">			s[x] = <span class="number">1</span>;</span><br><span class="line">			s[y] = <span class="number">0</span>;</span><br><span class="line">			sl[x] = <span class="number">0</span>;</span><br><span class="line">			<span class="built_in">ss</span>(y);</span><br><span class="line">			<span class="built_in">ins</span>(y);</span><br><span class="line">		&#125;</span><br><span class="line">		s[a] = <span class="number">1</span>;</span><br><span class="line">		f[a] = f[u];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = r + <span class="number">1</span>; i &lt; p[u].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">			s[p[u][i]] = <span class="number">-1</span>;</span><br><span class="line">			<span class="built_in">ss</span>(p[u][i]);</span><br><span class="line">		&#125;</span><br><span class="line">		st[u] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">on</span><span class="params">(<span class="type">const</span> Q &amp;e)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> u = st[e.u], v = st[e.v], a;</span><br><span class="line">		<span class="keyword">if</span> (s[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">			f[v] = e.u;</span><br><span class="line">			s[v] = <span class="number">1</span>;</span><br><span class="line">			a = st[lk[v]];</span><br><span class="line">			sl[v] = sl[a] = s[a] = <span class="number">0</span>;</span><br><span class="line">			<span class="built_in">ins</span>(a);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!s[v]) &#123;</span><br><span class="line">			a = <span class="built_in">lca</span>(u, v);</span><br><span class="line">			<span class="keyword">if</span> (!a) &#123;</span><br><span class="line">				<span class="built_in">aug</span>(u, v);</span><br><span class="line">				<span class="built_in">aug</span>(v, u);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span></span><br><span class="line">				<span class="built_in">add</span>(u, a, v);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fill</span>(s + <span class="number">1</span>, s + <span class="number">1</span> + m, <span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">fill</span>(sl + <span class="number">1</span>, sl + <span class="number">1</span> + m, <span class="number">0</span>);</span><br><span class="line">		h = <span class="number">1</span>;</span><br><span class="line">		t = <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> i, j;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">			<span class="keyword">if</span> (st[i] == i &amp;&amp; !lk[i]) &#123;</span><br><span class="line">				f[i] = s[i] = <span class="number">0</span>;</span><br><span class="line">				<span class="built_in">ins</span>(i);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">if</span> (h &gt; t)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">while</span> (h &lt;= t) &#123;</span><br><span class="line">				<span class="type">int</span> u = q[h++], v;</span><br><span class="line">				<span class="keyword">if</span> (s[st[u]] != <span class="number">1</span>)</span><br><span class="line">					<span class="keyword">for</span> (v = <span class="number">1</span>; v &lt;= n; v++)</span><br><span class="line">						<span class="keyword">if</span> (e[u][v].w &gt; <span class="number">0</span> &amp;&amp; st[u] != st[v]) &#123;</span><br><span class="line">							<span class="keyword">if</span> (<span class="built_in">d</span>(e[u][v]))</span><br><span class="line">								<span class="built_in">upd</span>(u, st[v]);</span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">on</span>(e[u][v]))</span><br><span class="line">								<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">						&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			T x = inf;</span><br><span class="line">			<span class="keyword">for</span> (i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">				<span class="keyword">if</span> (st[i] == i &amp;&amp; s[i] == <span class="number">1</span>)</span><br><span class="line">					x = <span class="built_in">min</span>(x, lab[i] &gt;&gt; <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">				<span class="keyword">if</span> (st[i] == i &amp;&amp; sl[i] &amp;&amp; s[i] != <span class="number">1</span>)</span><br><span class="line">					x = <span class="built_in">min</span>(x, <span class="built_in">d</span>(e[sl[i]][i]) &gt;&gt; s[i] + <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">				<span class="keyword">if</span> (s[st[i]] != <span class="number">-1</span>)</span><br><span class="line">					<span class="keyword">if</span> ((lab[i] += (s[st[i]] * <span class="number">2</span> - <span class="number">1</span>) * x) &lt;= <span class="number">0</span>)</span><br><span class="line">						<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">for</span> (i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">				<span class="keyword">if</span> (st[i] == i &amp;&amp; s[st[i]] != <span class="number">-1</span>)</span><br><span class="line">					lab[i] += (<span class="number">2</span> - s[st[i]] * <span class="number">4</span>) * x;</span><br><span class="line">			h = <span class="number">1</span>;</span><br><span class="line">			t = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">				<span class="keyword">if</span> (st[i] == i &amp;&amp; sl[i] &amp;&amp; st[sl[i]] != i &amp;&amp; !<span class="built_in">d</span>(e[sl[i]][i]) &amp;&amp;</span><br><span class="line">				    <span class="built_in">on</span>(e[sl[i]][i]))</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">for</span> (i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">				<span class="keyword">if</span> (st[i] == i &amp;&amp; s[i] == <span class="number">1</span> &amp;&amp; !lab[i])</span><br><span class="line">					<span class="built_in">ex</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> tuple&lt;<span class="type">int</span>, <span class="type">int</span>, T&gt; E;</span><br><span class="line">	<span class="function">T <span class="title">max_weighted_general_match</span><span class="params">(<span class="type">int</span> x, <span class="type">const</span> vector&lt;E&gt; &amp;edges)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		n = m = x;</span><br><span class="line">		<span class="built_in">memset</span>(ed + <span class="number">1</span>, <span class="number">0</span>, m * <span class="keyword">sizeof</span> ed[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">memset</span>(lk + <span class="number">1</span>, <span class="number">0</span>, m * <span class="keyword">sizeof</span> lk[<span class="number">0</span>]);</span><br><span class="line">		id = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">iota</span>(st + <span class="number">1</span>, st + n + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">		<span class="type">int</span> i, j;</span><br><span class="line">		T wm = <span class="number">0</span>;</span><br><span class="line">		T r = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">				e[i][j] = &#123;i, j, <span class="number">0</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> [u, v, w] : edges) &#123;</span><br><span class="line">			e[v][u].w = e[u][v].w = <span class="built_in">max</span>(e[u][v].w, w);</span><br><span class="line">			wm = <span class="built_in">max</span>(wm, w);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">			p[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">				b[i][j] = i * (i == j);</span><br><span class="line">		<span class="built_in">fill_n</span>(lab + <span class="number">1</span>, n, wm);</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">bfs</span>())</span><br><span class="line">			;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">			<span class="keyword">if</span> (lk[i])</span><br><span class="line">				r += e[i][lk[i]].w;</span><br><span class="line">		<span class="keyword">return</span> r / <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">weighted_blossom_tree&lt;<span class="type">long</span> <span class="type">long</span>, <span class="number">400</span>&gt; wbt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="type">int</span> n, m;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	vector&lt;tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">long</span> <span class="type">long</span>&gt;&gt; <span class="built_in">edges</span>(m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> &amp;[u, v, w] : edges)</span><br><span class="line">		cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">	cout &lt;&lt; wbt.<span class="built_in">max_weighted_general_match</span>(n, edges) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">		cout &lt;&lt; wbt.lk[i] &lt;&lt; <span class="string">&quot; \n&quot;</span>[i == n]; <span class="comment">// 匹配</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://oldplace.github.io">player</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://oldplace.github.io/2025/02/14/%E6%9D%BF%E5%AD%90/">http://oldplace.github.io/2025/02/14/%E6%9D%BF%E5%AD%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://oldplace.github.io" target="_blank">Oldplace</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/my%20avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/my%20avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">player</div><div class="author-info__description">一个蒟蒻在网络上的温馨小窝</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">159</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">70</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/oldplace" target="_blank" title="Github"><i class="fa-brands fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://www.luogu.com.cn/user/65602" target="_blank" title="洛谷"><i class="iconfont icon-luogu" style="color: #1461e6;"></i></a><a class="social-icon" href="https://www.codeforces.com/profile/zhangjianjuncd" target="_blank" title="CodeForces"><i class="fa-solid fa-chart-simple" style="color: #fd9d17;"></i></a><a class="social-icon" href="https://atcoder.jp/users/juruozjj" target="_blank" title="AtCoder"><i class="fa-solid fa-a" style="color: #7e0101;"></i></a><a class="social-icon" href="https://loj.ac/u/zhangjianjunab" target="_blank" title="LibreOJ"><i class="fa-solid fa-l" style="color: #9fa4ad;"></i></a><a class="social-icon" href="https://uoj.ac/user/profile/zhangjianjunab" target="_blank" title="Universal Online Judge"><i class="fa-solid fa-u" style="color: #ece509;"></i></a><a class="social-icon" href="https://ac.nowcoder.com/acm/contest/profile/485838814" target="_blank" title="牛客竞赛"><i class="iconfont icon-niu1" style="color: #3c5867;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="toc-number">1.1.</span> <span class="toc-text">代码基本框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#makefile"><span class="toc-number">1.2.</span> <span class="toc-text">makefile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">编译优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#modint"><span class="toc-number">1.4.</span> <span class="toc-text">modint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95-STL"><span class="toc-number">1.5.</span> <span class="toc-text">调试 STL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#libstdc"><span class="toc-number">1.5.1.</span> <span class="toc-text">libstdc++</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BA%93"><span class="toc-number">1.5.2.</span> <span class="toc-text">函数库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">1.6.</span> <span class="toc-text">小工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%8B%8D"><span class="toc-number">1.7.</span> <span class="toc-text">对拍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E8%AE%BA"><span class="toc-number">2.</span> <span class="toc-text">数论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9F%A9%E9%98%B5"><span class="toc-number">2.1.</span> <span class="toc-text">简单矩阵</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.</span> <span class="toc-text">字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hash"><span class="toc-number">3.1.</span> <span class="toc-text">Hash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Trie"><span class="toc-number">3.2.</span> <span class="toc-text">Trie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACAM"><span class="toc-number">3.3.</span> <span class="toc-text">ACAM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KMP"><span class="toc-number">3.4.</span> <span class="toc-text">KMP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXKMP"><span class="toc-number">3.5.</span> <span class="toc-text">EXKMP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Manacher"><span class="toc-number">3.6.</span> <span class="toc-text">Manacher</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lyndon-%E5%88%86%E8%A7%A3"><span class="toc-number">3.7.</span> <span class="toc-text">Lyndon 分解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SA"><span class="toc-number">3.8.</span> <span class="toc-text">SA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PAM"><span class="toc-number">3.9.</span> <span class="toc-text">PAM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PAM-with-log-dp"><span class="toc-number">3.9.1.</span> <span class="toc-text">PAM with log dp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E4%B9%89-PAM"><span class="toc-number">3.9.2.</span> <span class="toc-text">广义 PAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E6%8F%92%E5%85%A5%E7%9A%84-PAM"><span class="toc-number">3.9.3.</span> <span class="toc-text">前后端插入的 PAM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAM"><span class="toc-number">3.10.</span> <span class="toc-text">SAM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%B2SAM-with-%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F"><span class="toc-number">3.10.1.</span> <span class="toc-text">单串SAM with 拓扑排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF-BFS-%E6%9E%84%E5%BB%BA%E5%B9%BF%E4%B9%89-SAM"><span class="toc-number">3.10.2.</span> <span class="toc-text">在线 BFS 构建广义 SAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF-DFS-%E6%9E%84%E5%BB%BA%E5%B9%BF%E4%B9%89-SAM"><span class="toc-number">3.10.3.</span> <span class="toc-text">离线 DFS 构建广义 SAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF-BFS-%E6%9E%84%E5%BB%BA%E5%B9%BF%E4%B9%89-SAM"><span class="toc-number">3.10.4.</span> <span class="toc-text">离线 BFS 构建广义 SAM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runs"><span class="toc-number">3.11.</span> <span class="toc-text">Runs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash-%E5%86%99%E6%B3%95"><span class="toc-number">3.11.1.</span> <span class="toc-text">Hash 写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SA-%E5%86%99%E6%B3%95"><span class="toc-number">3.11.2.</span> <span class="toc-text">SA 写法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">4.1.</span> <span class="toc-text">简单线段树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><span class="toc-number">4.2.</span> <span class="toc-text">简单树状数组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E8%AE%BA"><span class="toc-number">5.</span> <span class="toc-text">图论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LCA"><span class="toc-number">5.1.</span> <span class="toc-text">LCA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86"><span class="toc-number">5.2.</span> <span class="toc-text">简单树链剖分</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">多项式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTT"><span class="toc-number">6.1.</span> <span class="toc-text">NTT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8A%E5%9C%A8%E7%BA%BF%E5%8D%B7%E7%A7%AF-NTT"><span class="toc-number">6.2.</span> <span class="toc-text">半在线卷积 NTT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FWT"><span class="toc-number">6.3.</span> <span class="toc-text">FWT</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E8%AE%BA-1"><span class="toc-number">7.</span> <span class="toc-text">图论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%A6%E8%8A%B1%E6%A0%91%EF%BC%88%E4%B8%80%E8%88%AC%E5%9B%BE%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="toc-number">7.1.</span> <span class="toc-text">带花树（一般图最大匹配）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%A6%E6%9D%83%E5%B8%A6%E8%8A%B1%E6%A0%91%EF%BC%88%E4%B8%80%E8%88%AC%E5%9B%BE%E6%9C%80%E5%A4%A7%E6%9D%83%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="toc-number">7.2.</span> <span class="toc-text">带权带花树（一般图最大权匹配）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">7.3.</span> <span class="toc-text"> </span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By player</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadUtterances () {
  let ele = document.createElement('script')
  ele.setAttribute('id', 'utterances_comment')
  ele.setAttribute('src', 'https://utteranc.es/client.js')
  ele.setAttribute('repo', 'oldplace/oldplace.github.io')
  ele.setAttribute('issue-term', 'pathname')
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
  ele.setAttribute('theme', nowTheme)
  ele.setAttribute('crossorigin', 'anonymous')
  ele.setAttribute('async', 'true')
  document.getElementById('utterances-wrap').insertAdjacentElement('afterbegin',ele)
}

function utterancesTheme (theme) {
  const iframe = document.querySelector('.utterances-frame')
  if (iframe) {
    const theme = theme === 'dark' ? 'photon-dark' : 'github-light'
    const message = {
      type: 'set-theme',
      theme: theme
    };
    iframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }
}

btf.addModeChange('utterances', utterancesTheme)

if ('Utterances' === 'Utterances' || !true) {
  if (true) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
  else loadUtterances()
} else {
  function loadOtherComment () {
    loadUtterances()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>