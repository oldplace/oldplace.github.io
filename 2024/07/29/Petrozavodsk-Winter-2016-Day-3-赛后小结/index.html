<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Petrozavodsk Winter 2016 Day 3 赛后小结 | Oldplace</title><meta name="author" content="player"><meta name="copyright" content="player"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="比赛链接：https:&#x2F;&#x2F;qoj.ac&#x2F;contest&#x2F;1350 怎么队长这么喜欢霓虹景的比赛。 开局队长秒 E ，我和队友看了 J ，发现 Purfer 板子题，上机写 WA 了一发，原因：没判数量为 $0$ 的情况，因为可能不存在一棵树有这样子的度数。 后面队长给队友说了一个 L ，说这是个边际距离简单题，然后上机下机 balabala ，最后留下名言：以后这种贪心题应该想好了再上机，没想好就">
<meta property="og:type" content="article">
<meta property="og:title" content="Petrozavodsk Winter 2016 Day 3 赛后小结">
<meta property="og:url" content="http://oldplace.github.io/2024/07/29/Petrozavodsk-Winter-2016-Day-3-%E8%B5%9B%E5%90%8E%E5%B0%8F%E7%BB%93/index.html">
<meta property="og:site_name" content="Oldplace">
<meta property="og:description" content="比赛链接：https:&#x2F;&#x2F;qoj.ac&#x2F;contest&#x2F;1350 怎么队长这么喜欢霓虹景的比赛。 开局队长秒 E ，我和队友看了 J ，发现 Purfer 板子题，上机写 WA 了一发，原因：没判数量为 $0$ 的情况，因为可能不存在一棵树有这样子的度数。 后面队长给队友说了一个 L ，说这是个边际距离简单题，然后上机下机 balabala ，最后留下名言：以后这种贪心题应该想好了再上机，没想好就">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oldplace.github.io/img/my%20avatar.jpg">
<meta property="article:published_time" content="2024-07-29T03:46:28.000Z">
<meta property="article:modified_time" content="2024-07-30T03:04:57.518Z">
<meta property="article:author" content="player">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://oldplace.github.io/img/my%20avatar.jpg"><link rel="shortcut icon" href="/img/author16.png"><link rel="canonical" href="http://oldplace.github.io/2024/07/29/Petrozavodsk-Winter-2016-Day-3-%E8%B5%9B%E5%90%8E%E5%B0%8F%E7%BB%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Petrozavodsk Winter 2016 Day 3 赛后小结',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-07-30 11:04:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4233465_4sh0n7ckry.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/my%20avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">158</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">70</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Oldplace"><span class="site-name">Oldplace</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Petrozavodsk Winter 2016 Day 3 赛后小结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-29T03:46:28.000Z" title="发表于 2024-07-29 11:46:28">2024-07-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-30T03:04:57.518Z" title="更新于 2024-07-30 11:04:57">2024-07-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BF%A1%E6%81%AF%E5%AD%A6/">信息学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Petrozavodsk Winter 2016 Day 3 赛后小结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><p>比赛链接：<a target="_blank" rel="noopener" href="https://qoj.ac/contest/1350">https://qoj.ac/contest/1350</a></p>
<p>怎么队长这么喜欢霓虹景的比赛。</p>
<p>开局队长秒 E ，我和队友看了 J ，发现 Purfer 板子题，上机写 WA 了一发，原因：没判数量为 $0$ 的情况，因为可能不存在一棵树有这样子的度数。</p>
<p>后面队长给队友说了一个 L ，说这是个边际距离简单题，然后上机下机 balabala ，最后留下名言：以后这种贪心题应该想好了再上机，没想好就上有点唐了。</p>
<p>期间我和队长聊起 B ，然后交流了一下，大概做法是二分 + 并查集，还有个曼哈顿距离 $\ge D$ 的经典 trick ，拆成四种式子分别加，只会算少不会算多，队长说他搞一下，我先去看了 M ，M 是个构造，因为我是构造苦手，而且队长好像搞 B 搞晕了，就和他交换了题目。</p>
<p>后面发现 B 的四种情况的两两连边，只需要考虑至少有一方为最大值的情况就行了，上机结果 T 了，后面发现是一个全新的错误：</p>
<p>二分如果 $r$ 的量级为 $2<em>10^{9}$ ，那么有可能在算 $mid$ 的时候 $2</em>10^{9}+2*10^{9}$ 爆 int ，所以应该写成：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid = l + (r - l) / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>学到了学到了。<del>结果这一场的后面又犯了一个这样的错误</del></p>
<p>B AC 后，L 也 AC 了，我在看 C ，感觉是疑似背包的东西，这时队长声称，I 是 CF div2 D 的 SB 题，跟我讲了一遍做法，我当时觉得并不好写，而且手里还有 C ，拒绝上机的，队长遂找到 Imakf ，和其交流，Imakf 也觉得好写，遂上机。</p>
<p>这时一个小时过去了。</p>
<p>然后我和队长交流 C ，我声称背包大小只有 $±2V$ ，队长认同了，也许？然后因为没有机时，我去看 D 了，感觉 D 是一个 dp 就能完成，注意到匹配不能唯一决定的情况当且仅当两个序列后面的一段都是相同的，当某个串跳出这一段的时候，就又能唯一确定匹配了，而这一段的匹配数量是一个折线法就能完成的事，需要枚举没跳出这一段的长度，因此时间复杂度是 ：$O(n^2+\mathrm{极长相等的一段的长度的平方和})$ ，注意到后者也是至多 $O(n^2)$ 的，所以可以 AC 。（说起来特别唐的是，复杂度我其实算错了，按照我当时的想法，复杂度应该是 $O(n^2+\mathrm{极长相等的一段的长度的和})$ ，但我当时其实少计算某个部分的复杂度，所以真正正确的复杂度还是 $O(n^2+\mathrm{极长相等的一段的长度的平方和})$ 的，只能说恰好负负得正了，运气真好）</p>
<p>然后 Imakf 感觉 I 有点细节，下来交流，我上机把 C，D 写了，但是这里我犯了一个错误，就是应该我在 AC 了 C 的时候，应该让队友上机，而不应该连续上机。</p>
<p>一个简单的情形，如果队里两个人手里都有 $2$ 个题，那么应该是一人轮流上一个题，原因是：</p>
<ol>
<li>首先保证一个人不会在机上红温。</li>
<li>其次保证每个人在一个比较长的时间段都有在机下的时间，能够保证每个题目每个人都能给出他的观察，防止出现能给出关键观察的人在机上的情况。</li>
<li>同时如果一个人在机上写错了什么东西，打印下来看，另外一个人可以直接上机，不会浪费机时，如果一个人先上完了所有的题，那么后一个人一旦在机上遇到错误，需要下机的时候，队伍里没有人手里有题，机时就会空缺，这是十分严重的问题。</li>
</ol>
<p>总之这里确实犯了一个决策上的错误，只能说当时手感火辣，当了机霸。</p>
<p>在我写 C,D 的期间，队友们讨论出了 H 。</p>
<p> Imakf 上机写了一下 I ，第一发 RE ，此时两小时，半个小时后过了，感觉这题确实难写，队长说好写只能说队长太牛了，不过我确实不太会写代码。</p>
<p> Imakf 搞 I 的期间我想了想 H ，发现好像是简单容斥 dp ，两点半的时候上机过了，还犯了个错误，我以为回到原点是四个方向的步数一样，实际上是四个方向两两步数一样，只能说唐了。</p>
<p>队长上机写 H ，我和 Imakf 开始讨论 G ，我们得出结论，这道题目是史，也有可能是我们做法不太行，反正是容斥 + 讨论 + 拉格朗日插值。</p>
<p>三个小时，队长过 H ，接下来半个小时，我思考怎么写 G ，队友们讨论 A ，三个半小时过了。</p>
<p>最后一个半小时我没有写出 G ，队友没做出 M ，爆。</p>
<p>感觉比较大的问题就是连续上机，其余没啥大问题。</p>
<h1 id="J"><a href="#J" class="headerlink" title="J"></a>J</h1><p>不会做的建议认真学习 Prufer 序列。</p>
<h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><p>先二分 $D$ 。</p>
<p>显然只有四种情况：$±x±y$ ，讨论 $x+y$ 和 $-x-y$ 的情况。</p>
<p>先从大到小排序，注意到有下面这张图成立，所以只用关心和最大值有关的连边。</p>
<p><img src="2.png" alt=""></p>
<p>时间复杂度：$O(n\log{n})$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findfa</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> fa[x] == x ? x : fa[x] = <span class="built_in">findfa</span>(fa[x]);&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">mer</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	x = <span class="built_in">findfa</span>(x);</span><br><span class="line">	y = <span class="built_in">findfa</span>(y);</span><br><span class="line">	<span class="keyword">if</span>(x != y) fa[x] = y;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">	<span class="type">int</span> val, id;</span><br><span class="line">&#125;a[<span class="number">4</span>][N];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> D)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) fa[i] = i;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++)&#123;</span><br><span class="line">		<span class="type">int</span> j = <span class="number">3</span> ^ i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(a[i][<span class="number">1</span>].val + a[j][k].val &gt;= D) cnt += <span class="built_in">mer</span>(a[i][<span class="number">1</span>].id, a[j][k].id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cnt == n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">		<span class="type">int</span> x, y;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">		a[<span class="number">0</span>][i] = &#123;x + y, i&#125;;</span><br><span class="line">		a[<span class="number">1</span>][i] = &#123;x - y, i&#125;;</span><br><span class="line">		a[<span class="number">2</span>][i] = &#123;- x + y, i&#125;;</span><br><span class="line">		a[<span class="number">3</span>][i] = &#123;- x - y, i&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++)&#123;</span><br><span class="line">		<span class="built_in">sort</span>(a[i] + <span class="number">1</span>, a[i] + n + <span class="number">1</span>, [](node x, node y)&#123;<span class="keyword">return</span> x.val &gt; y.val;&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">2e9</span>, mid, ans = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">		mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">check</span>(mid)) l = mid + <span class="number">1</span>, ans = mid;</span><br><span class="line">		<span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><p>首先，注意到初始点在 $x$ ，则跳跃若干次后的坐标形如：</p>
<script type="math/tex; mode=display">2(\sum\limits_{i=1}^{k}a_{b_{i}}*(-1)^{i-1})+x*(-1)^{k}</script><p>前面部分是可以类似背包一样跑的，或者说类似同余最短路那样跑，具体来说，以 $k$ 的奇偶性和 $\sum\limits_{i=1}^{k}a_{b_{i}}*(-1)^{i-1}$ 的数值跑宽搜。</p>
<p>现在有一个关键，这个宽搜的大小多大，直觉告诉我是 $±2V$ ，这样时间复杂度是：$O(nV)$ 的。</p>
<p>后面证明了。</p>
<p>具体来说，我们证明，若终点的绝对值 $\le V$ ，则一定存在一个顺序使得 $\forall 1\le j\le k,|\sum\limits_{i=1}^{j}a_{b_{i}}*(-1)^{i-1}|\le 2V$ ：</p>
<p>证明方法为设现在的值为 $x$ 。</p>
<p>设正贡献的数组为 ：$a_{1}\le a_{2}\le …\le a_{k}$</p>
<p>设负贡献的数组为 ：$b_{1}\le b_{2}\le …\le b_{k}$</p>
<p>不妨设 $x\ge 0$ ：</p>
<p>则如果 $a_{1}-b_{k}\ge 0$ ，则 $a_{i}-b_{i}\ge 0$ ，则 $x\le$ 目标，所以过程中 $\le 2V$ 。</p>
<p>如果 $a_{1}-b_{k}&lt;0$ ，则进行这样子的操作，操作完后 $-V\le x’\le x$ ，证毕。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e2</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> V = <span class="number">1e4</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> B = <span class="number">2</span> * V;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> L = <span class="number">4</span> * V;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = L + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="type">int</span> d[<span class="number">2</span>][MAXV];</span><br><span class="line"><span class="type">int</span> n, q, a[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">pd</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> mid, <span class="type">int</span> r)</span></span>&#123;<span class="keyword">return</span> l &lt;= mid &amp;&amp; mid &lt;= r;&#125;</span><br><span class="line">queue&lt;PII&gt; p;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cin &gt;&gt; a[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= L; i++) d[<span class="number">0</span>][i] = d[<span class="number">1</span>][i] = INF;</span><br><span class="line">	d[<span class="number">0</span>][B] = <span class="number">0</span>;</span><br><span class="line">	p.<span class="built_in">push</span>(&#123;<span class="number">0</span>, B&#125;);</span><br><span class="line">	<span class="keyword">while</span>(!p.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">auto</span> [t, v] = p.<span class="built_in">front</span>();</span><br><span class="line">		<span class="type">int</span> val = d[t][v];</span><br><span class="line">		p.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">			<span class="type">int</span> nv = a[i] - (v - B) + B;</span><br><span class="line">			<span class="keyword">if</span>(!<span class="built_in">pd</span>(<span class="number">0</span>, nv, L)) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(d[t ^ <span class="number">1</span>][nv] == INF)&#123;</span><br><span class="line">				d[t ^ <span class="number">1</span>][nv] = val + <span class="number">1</span>;</span><br><span class="line">				p.<span class="built_in">push</span>(&#123;t ^ <span class="number">1</span>, nv&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cin &gt;&gt; q;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; i++)&#123;</span><br><span class="line">		<span class="type">int</span> s, t;</span><br><span class="line">		cin &gt;&gt; s &gt;&gt; t;</span><br><span class="line">		<span class="keyword">if</span>((s &amp; <span class="number">1</span>) != (t &amp; <span class="number">1</span>))&#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;-1\n&quot;</span>;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> ans = <span class="built_in">min</span>(d[<span class="number">0</span>][(t - s) / <span class="number">2</span> + B], d[<span class="number">1</span>][(t + s) / <span class="number">2</span> + B]);</span><br><span class="line">		<span class="keyword">if</span>(ans == INF) ans = <span class="number">-1</span>;</span><br><span class="line">		cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><p>注意到一个事情，假如我给你一个方案，什么时候会有多个选择。</p>
<p>不妨设前 $t$ 个字母一定能够唯一确定，意思是存在唯一的 $i$ 和 $j$ 满足第一个数组前 $i$ 个和第二个数组前 $j$ 个能够合并出这个数组前 $t$ 个数字。</p>
<p>思考一下转移，如果 $a[i+1]≠b[j+1]$ ，那么 $t$ 可以直接 $+1$ 。</p>
<p>否则设 $len$ 为后面的最长相等连续段，注意到 $len$ 之后的字符是不同的，因此下一次能够唯一确定的时间在 $a[i+len+1],b[j+len+1]$ 中出现其中一个，而在这之前的匹配注意都存在多种的选择，其中直接将 $i,j$ 之后的匹配交换就是一种新的选择，因此我们选择直接记录这一段的方案，然后直接转移到 $i+len+1$ 或者 $j+len+1$ 的位置。</p>
<p>好了，大体思路有了，设计方程和转移：</p>
<p>$f[i][j]$ 表示有多少个长度为 $i+j$ 的数组能够唯一确定，且对应的 $i,j$ 就是下标中的 $i,j$ 的方案数。</p>
<p>转移就是如果后面的最长相等连续段是 $0$ ，则直接转移，否则转移到 $i+len+1$ ，枚举 $j$ 的位置或者反过来。</p>
<p>则时间复杂度为 ：$O(n^2+\mathrm{极长相等的一段的长度的平方和})$ ，注意到极长的相等子串的长度和为 $n$ ，具体来说，肯定是第一个数组的一个切割，以是否在第二个数组中连续为指标，所以平方和 $\le n^2$ ，所以总时间复杂度为 ：$O(n^2)$ ，做闭。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">const</span> LL mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> a[N], b[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line">LL dp[N][N], fc[N * <span class="number">2</span>], nfc[N * <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function">LL <span class="title">C</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x &lt; y || y &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> fc[x] * nfc[y] % mod * nfc[x - y] % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">calc_</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">C</span>(x, (x + y) / <span class="number">2</span>);&#125;</span><br><span class="line"><span class="function">LL <span class="title">calc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="built_in">calc_</span>(x, y) - <span class="built_in">calc_</span>(x, - <span class="number">2</span> - y) + mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span><span class="params">(LL &amp;x, LL y)</span></span>&#123;x = (x + y) % mod;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	nfc[<span class="number">0</span>] = nfc[<span class="number">1</span>] = fc[<span class="number">0</span>] = fc[<span class="number">1</span>] = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n + n; i++) nfc[i] = (mod - mod / i) * nfc[mod % i] % mod;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n + n; i++) fc[i] = fc[i - <span class="number">1</span>] * i % mod, nfc[i] = nfc[i - <span class="number">1</span>] * nfc[i] % mod;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cin &gt;&gt; a[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cin &gt;&gt; b[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; i--)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = n; j &gt;= <span class="number">1</span>; j--)&#123;</span><br><span class="line">			<span class="keyword">if</span>(a[i] == b[j]) f[i][j] = f[i + <span class="number">1</span>][j + <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= n; j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(!dp[i][j]) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(!f[i + <span class="number">1</span>][j + <span class="number">1</span>])&#123;</span><br><span class="line">				<span class="keyword">if</span>(i != n) <span class="built_in">upd</span>(dp[i + <span class="number">1</span>][j], dp[i][j]);</span><br><span class="line">				<span class="keyword">if</span>(j != n) <span class="built_in">upd</span>(dp[i][j + <span class="number">1</span>], dp[i][j]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(i == j &amp;&amp; f[i + <span class="number">1</span>][j + <span class="number">1</span>] == n - i)&#123;</span><br><span class="line">					<span class="built_in">upd</span>(dp[n][n], <span class="built_in">calc</span>(f[i + <span class="number">1</span>][j + <span class="number">1</span>] * <span class="number">2</span>, <span class="number">0</span>) * dp[i][j]);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(f[i + <span class="number">1</span>][j + <span class="number">1</span>] != n - i)&#123;</span><br><span class="line">					<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt;= f[i + <span class="number">1</span>][j + <span class="number">1</span>]; k++)&#123;</span><br><span class="line">						<span class="built_in">upd</span>(dp[i + f[i + <span class="number">1</span>][j + <span class="number">1</span>] + <span class="number">1</span>][j + k], <span class="built_in">calc</span>(f[i + <span class="number">1</span>][j + <span class="number">1</span>] + k, f[i + <span class="number">1</span>][j + <span class="number">1</span>] - k) * dp[i][j]);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(f[i + <span class="number">1</span>][j + <span class="number">1</span>] != n - j)&#123;</span><br><span class="line">					<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt;= f[i + <span class="number">1</span>][j + <span class="number">1</span>]; k++)&#123;</span><br><span class="line">						<span class="built_in">upd</span>(dp[i + k][j + f[i + <span class="number">1</span>][j + <span class="number">1</span>] + <span class="number">1</span>], <span class="built_in">calc</span>(f[i + <span class="number">1</span>][j + <span class="number">1</span>] + k, f[i + <span class="number">1</span>][j + <span class="number">1</span>] - k) * dp[i][j]);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; dp[n][n] &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="H"><a href="#H" class="headerlink" title="H"></a>H</h1><p>感觉是简单容斥，不知道为什么刚上手没有思路，还要想一会才发现是简单容斥。</p>
<p>设 $f[n]$ 表示 $n$ 步的答案，$g[n]$ 表示从原点出发，$n$ 步以后第一次回到原点的方案数。</p>
<p>考虑 $f[n+1]-f[n]$ ，如果不考虑去重，增量是 $4^{n+1}$ （路径个数），但是问题是有些路径可能以前到过这个格子，所以枚举上一次到达这个格子的时间 $i$ ，那么下一次重复经过格子的时间为 $n+1$ 的路径个数为：$4^{i}*g[n+1-i]$ ，减去即可，因为枚举的是恰好上一次，而不是之前的所有次数，所以恰好把所有重复贡献减掉，就是答案。</p>
<p>时间复杂度：$O(n^2)$ 。</p>
<h1 id="G"><a href="#G" class="headerlink" title="G"></a>G</h1><p>我们的做法是尝试枚举最终在数轴上有几段，现在先解决两段的情况：</p>
<p>注意到如果我们认为 $1,2$ 合并成一段，$3,4$ 合并成一段，那么不妨把前者的长度设为 $x$ 坐标，后者长度视为 $y$ 坐标，那么对应的可能长度在平面上是个矩形。</p>
<p>那么枚举所有可能的组合，就得到了一堆矩形，现在就只需要统计这些矩形所覆盖的区域的贡献，其中 $(x,y)$ 的贡献为：</p>
<ol>
<li>$x+y+1&gt;n$ ，则贡献为 $0$ 。</li>
<li>否则为 $\binom{n-x-y+1}{2}$ 。</li>
</ol>
<p>不妨考虑用子集容斥处理，因此我们只要能在接近 $O(1)$ 的时间算出一个矩形的贡献就行了。</p>
<p>由于 $x+y+1&gt;n$ 的时候贡献为 $0$ ，因此不能直接二元的多项式插值，因此不妨考虑这样计数，枚举 $x+y$ ，注意到 $x+y$ 相等的时候组合数是同一个，考虑用组合数 <em> 个数的方式计数，相当于用 $x+y=t$ 的线扫过整个矩形，然后 $x+y=t$ 的贡献为：$\binom{n-t+1}{2}</em>\mathrm{线经过的矩形格子数}$ 。</p>
<p>注意到个数可以分为三段：个数不断 $+1$ ，个数恒定，个数 $-1$ ，分为三段，每一段的答案都是个关于这一段的长度的四次函数，可以拉格朗插值求得。</p>
<p>经过计算，这里可能的组合数量上界为 $20$ 个，所以可以直接容斥。</p>
<p>一段和四段都是简单的，问题在于三段，三段可能有 $36$ 种组合，而且立方体计数很麻烦，爆。</p>
<p>但是注意到在三维中只有一维有范围，那么计数问题解决了，其次，不妨把有范围的称为这个组合的方向，同方向的组合之间只有两种关系：不交和相等，因此去重后，四个以上的组合的立方体的交集一定为空，所以就可以容斥了。</p>
<p>然后就做完了，写起来非常的史。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;LL, LL&gt; PLL;</span><br><span class="line"><span class="keyword">typedef</span> array&lt;PLL, 2&gt; AP2;</span><br><span class="line"><span class="keyword">typedef</span> array&lt;PLL, 3&gt; AP3;</span><br><span class="line"><span class="type">const</span> LL mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> B = <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> T = <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> S = <span class="number">1e2</span> + <span class="number">5</span>;</span><br><span class="line"><span class="function">LL <span class="title">ksm</span><span class="params">(LL x, LL y)</span></span>&#123;</span><br><span class="line">	LL ans = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">while</span>(y)&#123;</span><br><span class="line">		<span class="keyword">if</span>(y &amp; <span class="number">1</span>) ans = ans * x % mod;</span><br><span class="line">		x = x * x % mod;</span><br><span class="line">		y &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">LL nfc[B + <span class="number">5</span>], fc[B + <span class="number">5</span>];</span><br><span class="line"><span class="function">LL <span class="title">C</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="built_in">assert</span>(x &gt;= y &amp;&amp; y &gt;= <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">assert</span>(y &lt;= B);</span><br><span class="line">	LL ans = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; y; i++) ans = ans * (x - i) % mod;</span><br><span class="line">	<span class="keyword">return</span> ans * nfc[y] % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">ni</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	LL type = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">if</span>(x &lt; <span class="number">0</span>) type = mod - <span class="number">1</span>, x = -x;</span><br><span class="line">	<span class="built_in">assert</span>(x &lt;= B);</span><br><span class="line">	<span class="keyword">if</span>(x &lt;= <span class="number">1</span>) <span class="keyword">return</span> type;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> nfc[x] * fc[x - <span class="number">1</span>] % mod * type % mod;</span><br><span class="line">&#125;</span><br><span class="line">LL divv[T + <span class="number">5</span>], fl[T + <span class="number">5</span>], fr[T + <span class="number">5</span>];</span><br><span class="line"><span class="function">LL <span class="title">calc1</span><span class="params">(<span class="type">const</span> vector&lt;LL&gt; &amp;pos, <span class="type">int</span> x)</span></span>&#123; <span class="comment">// x = 0/1/.../T</span></span><br><span class="line">	<span class="built_in">assert</span>(pos.<span class="built_in">size</span>() == T &amp;&amp; x &gt;= T);</span><br><span class="line">	fl[<span class="number">0</span>] = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; T; i++) fl[i + <span class="number">1</span>] = fl[i] * (x - i + mod) % mod;</span><br><span class="line">	fr[T - <span class="number">1</span>] = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = T - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) fr[i - <span class="number">1</span>] = fr[i] * (x - i + mod) % mod;</span><br><span class="line">	LL ans = <span class="number">0ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; T; i++)&#123;</span><br><span class="line">		ans = (ans + fl[i] * fr[i] % mod * pos[i] % mod * divv[i]) % mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	nfc[<span class="number">0</span>] = nfc[<span class="number">1</span>] = fc[<span class="number">0</span>] = fc[<span class="number">1</span>] = <span class="number">1ll</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= B; i++) nfc[i] = (mod - mod / i) * nfc[mod % i] % mod;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= B; i++) fc[i] = fc[i - <span class="number">1</span>] * i % mod, nfc[i] = nfc[i - <span class="number">1</span>] * nfc[i] % mod;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; T; i++)&#123;</span><br><span class="line">		divv[i] = <span class="number">1ll</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; T; j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">			divv[i] = divv[i] * <span class="built_in">ni</span>(i - j) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n, K, a[N];</span><br><span class="line"><span class="function">LL <span class="title">calc2</span><span class="params">(<span class="type">int</span> base, <span class="type">int</span> l, <span class="type">int</span> t, <span class="type">int</span> c, <span class="type">int</span> len)</span></span>&#123; <span class="comment">//[0,len-1]</span></span><br><span class="line">	LL sum = <span class="number">0</span>;</span><br><span class="line">	vector&lt;LL&gt; pos;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; T &amp;&amp; i &lt; len; i++)&#123;</span><br><span class="line">		sum = (sum + <span class="built_in">C</span>(n - base - i, c) * (l + t * i) % mod + mod) % mod;</span><br><span class="line">		<span class="keyword">if</span>(len &gt; T) pos.<span class="built_in">push_back</span>(sum);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(len &gt; T) <span class="keyword">return</span> <span class="built_in">calc1</span>(pos, len - <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> D2&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> D = <span class="number">2</span>;</span><br><span class="line">	AP2 sta[S];</span><br><span class="line">	<span class="type">int</span> top;</span><br><span class="line">	<span class="function">LL <span class="title">solve</span><span class="params">(AP2 x)</span></span>&#123; <span class="comment">// n - 1 &gt;= x + y</span></span><br><span class="line">		<span class="built_in">sort</span>(x.<span class="built_in">begin</span>(), x.<span class="built_in">end</span>(), [](PLL xx, PLL yy)&#123;<span class="keyword">return</span> xx.second - xx.first &lt; yy.second - yy.first;&#125;);</span><br><span class="line">		LL tmp = <span class="number">0ll</span>;</span><br><span class="line">		&#123;<span class="comment">//up</span></span><br><span class="line">			LL l = x[<span class="number">0</span>].first + x[<span class="number">1</span>].first, r = <span class="built_in">min</span>(x[<span class="number">0</span>].second + x[<span class="number">1</span>].first - <span class="number">1</span>, (n - <span class="number">1</span>) * <span class="number">1ll</span>);</span><br><span class="line">			<span class="keyword">if</span>(l &lt;= r) tmp = (tmp + <span class="built_in">calc2</span>(l - <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">			<span class="number">1</span>, <span class="number">2</span>, r - l + <span class="number">1</span>)) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		&#123;<span class="comment">//maintain</span></span><br><span class="line">			LL l = x[<span class="number">0</span>].second + x[<span class="number">1</span>].first, r = <span class="built_in">min</span>(x[<span class="number">0</span>].first + x[<span class="number">1</span>].second, (n - <span class="number">1</span>) * <span class="number">1ll</span>);</span><br><span class="line">			<span class="keyword">if</span>(l &lt;= r) tmp = (tmp + <span class="built_in">calc2</span>(l - <span class="number">1</span>, x[<span class="number">0</span>].second - x[<span class="number">0</span>].first + <span class="number">1</span>,</span><br><span class="line">			<span class="number">0</span>, <span class="number">2</span>, r - l + <span class="number">1</span>)) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		&#123;<span class="comment">//down</span></span><br><span class="line">			LL l = x[<span class="number">0</span>].first + x[<span class="number">1</span>].second + <span class="number">1</span>, r = <span class="built_in">min</span>(x[<span class="number">0</span>].second + x[<span class="number">1</span>].second, (n - <span class="number">1</span>) * <span class="number">1ll</span>);</span><br><span class="line">			<span class="keyword">if</span>(l &lt;= r) tmp = (tmp + <span class="built_in">calc2</span>(l - <span class="number">1</span>, x[<span class="number">0</span>].second - x[<span class="number">0</span>].first,</span><br><span class="line">			<span class="number">-1</span>, <span class="number">2</span>, r - l + <span class="number">1</span>)) % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tmp;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(AP2 x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= top; i++)&#123;</span><br><span class="line">			<span class="type">bool</span> bk = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; D; j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(x[j] != sta[i][j])&#123; bk = <span class="number">0</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(bk) <span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		sta[++top] = x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">LL <span class="title">dfs</span><span class="params">(<span class="type">int</span> dep, AP2 val, LL type, <span class="type">bool</span> bk)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; D; i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(val[i].second &lt; val[i].first) <span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(dep == top + <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(bk) <span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">solve</span>(val) * type % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		LL tmp = <span class="number">0ll</span>;</span><br><span class="line">		tmp = <span class="built_in">dfs</span>(dep + <span class="number">1</span>, val, type, bk);</span><br><span class="line">		<span class="keyword">if</span>(bk) val = sta[dep];</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; D; i++)&#123;</span><br><span class="line">				val[i].first = <span class="built_in">max</span>(val[i].first, sta[dep][i].first);</span><br><span class="line">				val[i].second = <span class="built_in">min</span>(val[i].second, sta[dep][i].second);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		tmp = (tmp + <span class="built_in">dfs</span>(dep + <span class="number">1</span>, val, mod - type, <span class="number">0</span>)) % mod;</span><br><span class="line">		<span class="keyword">return</span> tmp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> D3&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> D = <span class="number">3</span>;</span><br><span class="line">	AP3 sta[S];</span><br><span class="line">	<span class="type">int</span> top;</span><br><span class="line">	<span class="function">LL <span class="title">solve</span><span class="params">(AP3 x)</span></span>&#123;</span><br><span class="line">		<span class="built_in">sort</span>(x.<span class="built_in">begin</span>(), x.<span class="built_in">end</span>(), [](PLL xx, PLL yy)&#123;<span class="keyword">return</span> xx.second - xx.first &gt; yy.second - yy.first;&#125;);</span><br><span class="line">		<span class="built_in">assert</span>(x[<span class="number">1</span>].second == x[<span class="number">1</span>].first);</span><br><span class="line">		<span class="comment">// n + 1 - x - y - z &gt;= D</span></span><br><span class="line">		x[<span class="number">0</span>].second = <span class="built_in">min</span>(x[<span class="number">0</span>].second, n + <span class="number">1</span> - D - x[<span class="number">1</span>].first - x[<span class="number">2</span>].first);</span><br><span class="line">		<span class="keyword">if</span>(x[<span class="number">0</span>].second &lt; x[<span class="number">0</span>].first) <span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">calc2</span>(x[<span class="number">0</span>].first + x[<span class="number">1</span>].first + x[<span class="number">2</span>].first - <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, x[<span class="number">0</span>].second - x[<span class="number">0</span>].first + <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(AP3 x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= top; i++)&#123;</span><br><span class="line">			<span class="type">bool</span> bk = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; D; j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(x[j] != sta[i][j])&#123; bk = <span class="number">0</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(bk) <span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		sta[++top] = x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">LL <span class="title">dfs</span><span class="params">(<span class="type">int</span> dep, AP3 val, LL type, <span class="type">bool</span> bk)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; D; i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(val[i].second &lt; val[i].first) <span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(dep == top + <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(bk) <span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">solve</span>(val) * type % mod;</span><br><span class="line">		&#125;</span><br><span class="line">		LL tmp = <span class="number">0ll</span>;</span><br><span class="line">		tmp = <span class="built_in">dfs</span>(dep + <span class="number">1</span>, val, type, bk);</span><br><span class="line">		<span class="keyword">if</span>(bk) val = sta[dep];</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; D; i++)&#123;</span><br><span class="line">				val[i].first = <span class="built_in">max</span>(val[i].first, sta[dep][i].first);</span><br><span class="line">				val[i].second = <span class="built_in">min</span>(val[i].second, sta[dep][i].second);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		tmp = (tmp + <span class="built_in">dfs</span>(dep + <span class="number">1</span>, val, mod - type, <span class="number">0</span>)) % mod;</span><br><span class="line">		<span class="keyword">return</span> tmp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(AP3 s, <span class="type">int</span> dep)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dep == K + <span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!s[<span class="number">0</span>].first || !s[<span class="number">1</span>].first) <span class="keyword">return</span> ;</span><br><span class="line">		<span class="keyword">if</span>(!s[<span class="number">2</span>].first) D2::<span class="built_in">push</span>(&#123;s[<span class="number">0</span>], s[<span class="number">1</span>]&#125;);</span><br><span class="line">		<span class="keyword">else</span> D3::<span class="built_in">push</span>(&#123;s[<span class="number">0</span>], s[<span class="number">1</span>], s[<span class="number">2</span>]&#125;);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; i++)&#123;</span><br><span class="line">		AP3 tmp = s;</span><br><span class="line">		tmp[i].first = <span class="built_in">max</span>(tmp[i].first, a[dep] * <span class="number">1ll</span>);</span><br><span class="line">		tmp[i].second += a[dep];</span><br><span class="line">		<span class="built_in">dfs</span>(tmp, dep + <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	<span class="comment">// vector&lt;LL&gt; tmp;</span></span><br><span class="line">	<span class="comment">// for(int i = 0; i &lt; T; i++) tmp.push_back(i*i);</span></span><br><span class="line">	<span class="comment">// cout &lt;&lt; calc(tmp, 9) &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	cin &gt;&gt; n &gt;&gt; K;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= K; i++) cin &gt;&gt; a[i];</span><br><span class="line">	<span class="built_in">sort</span>(a + <span class="number">1</span>, a + K + <span class="number">1</span>);</span><br><span class="line">	LL ans = <span class="number">0ll</span>;</span><br><span class="line">	&#123;</span><br><span class="line">		LL l = a[K], r = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= K; i++) r += a[i];</span><br><span class="line">		r = <span class="built_in">min</span>(n * <span class="number">1ll</span>, r);</span><br><span class="line">		ans = <span class="built_in">calc2</span>(l - <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, r - l + <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(K == <span class="number">4</span>)&#123;</span><br><span class="line">		LL tmp = <span class="number">0ll</span>, sum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= K; i++) sum += a[i];</span><br><span class="line">		<span class="keyword">if</span>(sum + K - <span class="number">1</span> &lt;= n) tmp = <span class="built_in">C</span>(n - sum + <span class="number">1</span>, <span class="number">4</span>) * fc[K] % mod;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">1</span>; l &lt;= K; l++)&#123;</span><br><span class="line">			<span class="type">int</span> r = l;</span><br><span class="line">			<span class="keyword">while</span>(r &lt; K &amp;&amp; a[l] == a[r + <span class="number">1</span>]) r++;</span><br><span class="line">			tmp = tmp * nfc[r - l + <span class="number">1</span>] % mod;</span><br><span class="line">			l = r;</span><br><span class="line">		&#125;</span><br><span class="line">		ans = (ans + tmp) % mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(&#123;PLL&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, PLL&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, PLL&#123;<span class="number">0</span>, <span class="number">0</span>&#125;&#125;, <span class="number">1</span>);</span><br><span class="line">	ans = (ans + D2::<span class="built_in">dfs</span>(<span class="number">1</span>, &#123;&#125;, mod - <span class="number">1</span>, <span class="number">1</span>)) % mod;</span><br><span class="line">	ans = (ans + D3::<span class="built_in">dfs</span>(<span class="number">1</span>, &#123;&#125;, mod - <span class="number">1</span>, <span class="number">1</span>)) % mod;</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说起来一个很唐的事情，这场前面二分 $l+r$ 爆了一次 int ，而这里在 D2 里面计算 $l$ 的时候有个加法，那里也爆了一次 int ，悲 。</p>
<p>事实证明蠢人是有可能在同一个坑跌倒第二次的，悲。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://oldplace.github.io">player</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://oldplace.github.io/2024/07/29/Petrozavodsk-Winter-2016-Day-3-%E8%B5%9B%E5%90%8E%E5%B0%8F%E7%BB%93/">http://oldplace.github.io/2024/07/29/Petrozavodsk-Winter-2016-Day-3-%E8%B5%9B%E5%90%8E%E5%B0%8F%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://oldplace.github.io" target="_blank">Oldplace</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/my%20avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/my%20avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">player</div><div class="author-info__description">一个蒟蒻在网络上的温馨小窝</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">158</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">70</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/oldplace" target="_blank" title="Github"><i class="fa-brands fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://www.luogu.com.cn/user/65602" target="_blank" title="洛谷"><i class="iconfont icon-luogu" style="color: #1461e6;"></i></a><a class="social-icon" href="https://www.codeforces.com/profile/zhangjianjuncd" target="_blank" title="CodeForces"><i class="fa-solid fa-chart-simple" style="color: #fd9d17;"></i></a><a class="social-icon" href="https://atcoder.jp/users/juruozjj" target="_blank" title="AtCoder"><i class="fa-solid fa-a" style="color: #7e0101;"></i></a><a class="social-icon" href="https://loj.ac/u/zhangjianjunab" target="_blank" title="LibreOJ"><i class="fa-solid fa-l" style="color: #9fa4ad;"></i></a><a class="social-icon" href="https://uoj.ac/user/profile/zhangjianjunab" target="_blank" title="Universal Online Judge"><i class="fa-solid fa-u" style="color: #ece509;"></i></a><a class="social-icon" href="https://ac.nowcoder.com/acm/contest/profile/485838814" target="_blank" title="牛客竞赛"><i class="iconfont icon-niu1" style="color: #3c5867;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#J"><span class="toc-number">1.</span> <span class="toc-text">J</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#B"><span class="toc-number">2.</span> <span class="toc-text">B</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C"><span class="toc-number">3.</span> <span class="toc-text">C</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#D"><span class="toc-number">4.</span> <span class="toc-text">D</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#H"><span class="toc-number">5.</span> <span class="toc-text">H</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#G"><span class="toc-number">6.</span> <span class="toc-text">G</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By player</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadUtterances () {
  let ele = document.createElement('script')
  ele.setAttribute('id', 'utterances_comment')
  ele.setAttribute('src', 'https://utteranc.es/client.js')
  ele.setAttribute('repo', 'oldplace/oldplace.github.io')
  ele.setAttribute('issue-term', 'pathname')
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
  ele.setAttribute('theme', nowTheme)
  ele.setAttribute('crossorigin', 'anonymous')
  ele.setAttribute('async', 'true')
  document.getElementById('utterances-wrap').insertAdjacentElement('afterbegin',ele)
}

function utterancesTheme (theme) {
  const iframe = document.querySelector('.utterances-frame')
  if (iframe) {
    const theme = theme === 'dark' ? 'photon-dark' : 'github-light'
    const message = {
      type: 'set-theme',
      theme: theme
    };
    iframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }
}

btf.addModeChange('utterances', utterancesTheme)

if ('Utterances' === 'Utterances' || !true) {
  if (true) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
  else loadUtterances()
} else {
  function loadOtherComment () {
    loadUtterances()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>